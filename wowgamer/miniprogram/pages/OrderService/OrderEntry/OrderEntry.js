"use strict";
const app = getApp();
Page({
    data: {
        mode: '',
        userId: '',
        orderId: '',
        characterName: '',
        RealmType: 1,
        characterId: '',
        serverName: '',
        showPassword: false,
        accountName: '',
        accountPassword: '',
        phoneNumber: '',
        hasGuard: 1,
        orderCatalog: '',
        orderCatalog1: '',
        orderCatalog2: '',
        orderCatalog3: '',
        money: 0,
        originMoney: 0,
        specializations: new Array(),
        note: '',
        orderStatus: 9,
        coupons: new Array(),
        couponIndex: 0
    },
    onLoad(options) {
        const data = JSON.parse(options.data);
        if (data.mode == 'AddNew') {
            this.setData({
                mode: data.mode,
                userId: wx.getStorageSync('userId'),
                orderCatalog: data.orderCatalog,
                orderCatalog1: data.orderCatalog1,
                orderCatalog2: data.orderCatalog2,
                orderCatalog3: data.orderCatalog3,
                money: data.money,
                originMoney: data.money,
                characterId: data.characterId
            });
        }
        if (data.mode == 'Detail') {
            this.setData({
                mode: data.mode,
                userId: data.userId,
                orderId: data.orderId
            });
        }
    },
    onShow() {
        if (this.data.mode == 'AddNew') {
            app.requestFuncPromise('/user/getCharacter', { characterId: this.data.characterId }, 'GET')
                .then(res => {
                if (parseInt(res.data.data.realmType) == 1) {
                    this.setData({
                        RealmType: parseInt(res.data.data.realmType),
                        characterName: res.data.data.characterName + '/' + res.data.data.accountName,
                        serverName: '正式服/' + res.data.data.realmZoneName + '/' + res.data.data.realmName
                    });
                }
                if (parseInt(res.data.data.realmType) == 2) {
                    this.setData({
                        RealmType: parseInt(res.data.data.realmType),
                        characterName: res.data.data.characterName + '/' + res.data.data.accountName,
                        serverName: '怀旧服/' + res.data.data.realmZoneName + '/' + res.data.data.realmName
                    });
                }
                res.data.data.characterSpecialization.split('#').forEach(x => {
                    let temp = x.split(':');
                    let data = {
                        specializations: new Array(),
                    };
                    if (parseInt(temp[1]) > 0) {
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                    }
                    this.setData(data);
                });
            });
            this.getAvailableCoupon();
        }
        if (this.data.mode == 'Detail') {
            app.requestFuncPromise('/order/orderDetail', { userId: this.data.userId, orderId: this.data.orderId }, 'GET')
                .then((res) => {
                this.setData({
                    characterId: res.data.data.characterId,
                    characterName: res.data.data.characterInfo,
                    serverName: res.data.data.characterRealm,
                    accountName: res.data.data.accountId,
                    accountPassword: res.data.data.accountPassword,
                    orderCatalog: res.data.data.orderCatalog,
                    phoneNumber: res.data.data.phone,
                    money: res.data.data.orderMoney,
                    originMoney: res.data.data.orderMoney,
                    hasGuard: res.data.data.saveguard,
                    note: res.data.data.note,
                    orderStatus: res.data.data.orderStatus
                }),
                    res.data.data.characterSpec.split('#').forEach(x => {
                        let temp = x.split(':');
                        let data = {
                            specializations: new Array(),
                        };
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                        this.setData(data);
                    });
            });
        }
    },
    inputNote(e) {
        this.setData({
            note: e.detail.value
        });
    },
    inputAccountName(e) {
        this.setData({
            accountName: e.detail.value
        });
    },
    ShowPassword() {
        this.setData({
            showPassword: !this.data.showPassword
        });
    },
    inputPassword(e) {
        this.setData({
            accountPassword: e.detail.value
        });
    },
    inputPhoneNumber(e) {
        this.setData({
            phoneNumber: e.detail.value
        });
    },
    changeGuard(e) {
        this.setData({
            hasGuard: e.detail.value
        });
    },
    getAvailableCoupon() {
        app.requestFuncPromise('/order/availableCoupon', { userId: this.data.userId }, 'GET')
            .then((res) => {
            if (res.data.success) {
                let data = {
                    coupons: new Array()
                };
                data.coupons.push({ id: 'null', status: 1, name: '不使用优惠券', discount: 0, expireTime: new Date() });
                res.data.couponList.forEach(x => {
                    if (x.status == 1) {
                        data.coupons.push({ id: x.couponId, status: x.couponStatus, name: x.couponName, discount: x.couponDiscount, expireTime: x.expireTime });
                    }
                });
                this.setData(data);
                this.calcMoney();
            }
        });
    },
    couponChange(e) {
        this.setData({
            couponIndex: e.detail.value
        });
        this.calcMoney();
    },
    calcMoney() {
        if (this.data.coupons[this.data.couponIndex].id != 'null') {
            let data = {
                money: this.data.money,
                originMoney: this.data.money
            };
            data.money = this.data.money * this.data.coupons[this.data.couponIndex].discount;
            this.setData(data);
        }
        else {
            let data = {
                money: this.data.originMoney,
                originMoney: this.data.originMoney
            };
            this.setData(data);
        }
    },
    formSubmit(e) {
        const _this = this;
        let specString = '';
        let checkValid = true;
        this.data.specializations.every(x => {
            if ((!isNaN(x.value) && x.value > 0)) {
                specString += x.name + ':' + x.value.toString() + '#';
                return true;
            }
            else {
                if (!isNaN(x.value) && x.value <= 0) {
                    wx.showToast({
                        title: '专精等级必须大于0',
                        icon: 'none',
                        duration: 1000
                    });
                    checkValid = false;
                    return false;
                }
                else {
                    wx.showToast({
                        title: '请输入专精等级',
                        icon: 'none',
                        duration: 1000
                    });
                }
                checkValid = false;
                return false;
            }
        });
        if (!checkValid) {
            return;
        }
        specString = specString.substring(0, specString.length - 1);
        let detailData = {
            orderId: this.data.orderId != '' ? this.data.orderId : '',
            userId: this.data.userId,
            orderType: 1,
            orderServer: this.data.RealmType,
            orderCatalog: this.data.orderCatalog,
            orderCatalog1: this.data.orderCatalog1,
            orderCatalog2: this.data.orderCatalog2,
            orderCatalog3: this.data.orderCatalog3,
            orderMoney: this.data.money,
            characterId: this.data.characterId,
            characterInfo: this.data.characterName,
            characterRealm: this.data.serverName,
            characterSpec: specString,
            accountId: e.detail.value.accountName,
            accountPassword: e.detail.value.accountPassword,
            saveguard: this.data.hasGuard,
            phone: e.detail.value.phoneNumber,
            note: e.detail.value.note,
            remoteAddr: '',
            couponId: ''
        };
        if (this.data.orderStatus == 9) {
            detailData.couponId = this.data.coupons[this.data.couponIndex].id != 'null' ? this.data.coupons[this.data.couponIndex].id : '';
        }
        if (detailData.accountId == "") {
            wx.showToast({
                title: '请输入账号',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        if (detailData.accountPassword == "") {
            wx.showToast({
                title: '请输入密码',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        if (detailData.phone == "") {
            wx.showToast({
                title: '请输入手机号码',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        wx.request({
            url: 'https://pv.sohu.com/cityjson?ie=utf-8',
            success: function (e) {
                console.log(e.data);
                const ipAddress = e.data.split(' ')[4].replace('"', '').replace('"', '').replace(',', '');
                detailData.remoteAddr = ipAddress;
                app.requestFunc('/order/saveOrder', detailData, 'POST', res => {
                    console.log(res.data);
                    if (res.data.success == true) {
                        if (res.data.payInfo) {
                            wx.requestPayment({
                                'timeStamp': res.data.payInfo.timeStamp.toString(),
                                'nonceStr': res.data.payInfo.nonceStr,
                                'package': res.data.payInfo.package,
                                'signType': res.data.payInfo.signType,
                                'paySign': res.data.payInfo.sign,
                                success: function (res) {
                                    console.log(res);
                                    wx.showToast({
                                        title: '支付成功',
                                        icon: 'none',
                                        duration: 1500
                                    });
                                    wx.navigateBack({
                                        delta: 1
                                    });
                                },
                                fail: function (res) {
                                    console.log(res);
                                    wx.showToast({
                                        title: '支付失败',
                                        icon: 'none',
                                        duration: 1500
                                    });
                                    _this.setData({
                                        mode: 'Detail'
                                    });
                                    _this.onShow();
                                }
                            });
                        }
                        else {
                            wx.showToast({
                                title: res.data.msg,
                                icon: 'none',
                                duration: 1000
                            });
                        }
                    }
                    else {
                        wx.showToast({
                            title: res.data.msg,
                            icon: 'none',
                            duration: 1000
                        });
                    }
                });
            }
        });
    },
    cancelOrder() {
        const _this = this;
        let detailData = {
            orderId: this.data.orderId,
            userId: this.data.userId
        };
        app.requestFunc('/order/cancelOrder', detailData, 'POST', res => {
            console.log(res.data);
            if (res.data.success == true) {
                wx.showToast({
                    title: '取消订单成功',
                    icon: 'none',
                    duration: 1500
                });
                wx.navigateBack({
                    delta: 1
                });
                _this.onShow();
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JkZXJFbnRyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9yZGVyRW50cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sRUFBYyxDQUFBO0FBRWhDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLElBQUksRUFBRSxFQUFFO1FBQ1IsTUFBTSxFQUFFLEVBQUU7UUFDVixPQUFPLEVBQUUsRUFBRTtRQUNYLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLFNBQVMsRUFBRSxDQUFDO1FBQ1osV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVLEVBQUUsRUFBRTtRQUNkLFlBQVksRUFBRSxLQUFLO1FBQ25CLFdBQVcsRUFBRSxFQUFFO1FBQ2YsZUFBZSxFQUFFLEVBQUU7UUFDbkIsV0FBVyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsQ0FBQztRQUNYLFlBQVksRUFBRSxFQUFFO1FBQ2hCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLEtBQUssRUFBRSxDQUFDO1FBQ1IsV0FBVyxFQUFFLENBQUM7UUFDZCxlQUFlLEVBQUUsSUFBSSxLQUFLLEVBQWlDO1FBQzNELElBQUksRUFBRSxFQUFFO1FBQ1IsV0FBVyxFQUFFLENBQUM7UUFDZCxPQUFPLEVBQUUsSUFBSSxLQUFLLEVBQWtGO1FBQ3BHLFdBQVcsRUFBRSxDQUFDO0tBQ2Y7SUFDRCxNQUFNLENBQUMsT0FBTztRQUNaLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQVMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLElBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxRQUFRLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO2dCQUNu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Z0JBQ0gsQ0FBQyxDQUFDLENBQUE7WUFDSixDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFdBQVc7UUFDVCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxVQUFVLEdBQUc7WUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQzFCLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07U0FDekIsQ0FBQTtRQUNELEdBQUcsQ0FBQyxXQUFXLENBQUMsb0JBQW9CLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRTtZQUM5RCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksRUFBRTtnQkFDNUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsUUFBUTtvQkFDZixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUM7Z0JBQ0gsRUFBRSxDQUFDLFlBQVksQ0FBQztvQkFDZCxLQUFLLEVBQUUsQ0FBQztpQkFDVCxDQUFDLENBQUE7Z0JBQ0YsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ2hCO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8g6I635Y+W5bqU55So5a6e5L6LXHJcbmNvbnN0IGFwcCA9IGdldEFwcDxJQXBwT3B0aW9uPigpXHJcblxyXG5QYWdlKHtcclxuICBkYXRhOiB7XHJcbiAgICBtb2RlOiAnJyxcclxuICAgIHVzZXJJZDogJycsXHJcbiAgICBvcmRlcklkOiAnJyxcclxuICAgIGNoYXJhY3Rlck5hbWU6ICcnLFxyXG4gICAgUmVhbG1UeXBlOiAxLFxyXG4gICAgY2hhcmFjdGVySWQ6ICcnLFxyXG4gICAgc2VydmVyTmFtZTogJycsXHJcbiAgICBzaG93UGFzc3dvcmQ6IGZhbHNlLFxyXG4gICAgYWNjb3VudE5hbWU6ICcnLFxyXG4gICAgYWNjb3VudFBhc3N3b3JkOiAnJyxcclxuICAgIHBob25lTnVtYmVyOiAnJyxcclxuICAgIGhhc0d1YXJkOiAxLFxyXG4gICAgb3JkZXJDYXRhbG9nOiAnJyxcclxuICAgIG9yZGVyQ2F0YWxvZzE6ICcnLFxyXG4gICAgb3JkZXJDYXRhbG9nMjogJycsXHJcbiAgICBvcmRlckNhdGFsb2czOiAnJyxcclxuICAgIG1vbmV5OiAwLFxyXG4gICAgb3JpZ2luTW9uZXk6IDAsXHJcbiAgICBzcGVjaWFsaXphdGlvbnM6IG5ldyBBcnJheTx7bmFtZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyfT4oKSxcclxuICAgIG5vdGU6ICcnLFxyXG4gICAgb3JkZXJTdGF0dXM6IDksXHJcbiAgICBjb3Vwb25zOiBuZXcgQXJyYXk8e2lkOiBzdHJpbmcsIHN0YXR1czogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIGRpc2NvdW50OiBudW1iZXIsIGV4cGlyZVRpbWU6IERhdGV9PigpLFxyXG4gICAgY291cG9uSW5kZXg6IDBcclxuICB9LFxyXG4gIG9uTG9hZChvcHRpb25zKSB7XHJcbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZSg8c3RyaW5nPm9wdGlvbnMuZGF0YSk7XHJcbiAgICBpZihkYXRhLm1vZGUgPT0gJ0FkZE5ldycpIHtcclxuICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICBtb2RlOiBkYXRhLm1vZGUsXHJcbiAgICAgICAgdXNlcklkOiB3eC5nZXRTdG9yYWdlU3luYygndXNlcklkJyksXHJcbiAgICAgICAgb3JkZXJDYXRhbG9nOiBkYXRhLm9yZGVyQ2F0YWxvZyxcclxuICAgICAgICBvcmRlckNhdGFsb2cxOiBkYXRhLm9yZGVyQ2F0YWxvZzEsXHJcbiAgICAgICAgb3JkZXJDYXRhbG9nMjogZGF0YS5vcmRlckNhdGFsb2cyLFxyXG4gICAgICAgIG9yZGVyQ2F0YWxvZzM6IGRhdGEub3JkZXJDYXRhbG9nMyxcclxuICAgICAgICBtb25leTogZGF0YS5tb25leSxcclxuICAgICAgICBvcmlnaW5Nb25leTogZGF0YS5tb25leSxcclxuICAgICAgICBjaGFyYWN0ZXJJZDogZGF0YS5jaGFyYWN0ZXJJZFxyXG4gICAgICB9KSBcclxuICAgIH1cclxuICAgIGlmKGRhdGEubW9kZSA9PSAnRGV0YWlsJykge1xyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIG1vZGU6IGRhdGEubW9kZSxcclxuICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkLFxyXG4gICAgICAgIG9yZGVySWQ6IGRhdGEub3JkZXJJZFxyXG4gICAgICB9KSBcclxuICAgIH1cclxuICB9LFxyXG4gIG9uU2hvdygpIHtcclxuICAgIGlmKHRoaXMuZGF0YS5tb2RlID09ICdBZGROZXcnKSB7XHJcbiAgICAgIGFwcC5yZXF1ZXN0RnVuY1Byb21pc2UoJy91c2VyL2dldENoYXJhY3RlcicsIHtjaGFyYWN0ZXJJZDogdGhpcy5kYXRhLmNoYXJhY3RlcklkfSwgJ0dFVCcpXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYocGFyc2VJbnQocmVzLmRhdGEuZGF0YS5yZWFsbVR5cGUpID09IDEpIHtcclxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgIFJlYWxtVHlwZTogcGFyc2VJbnQocmVzLmRhdGEuZGF0YS5yZWFsbVR5cGUpLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXJOYW1lOiByZXMuZGF0YS5kYXRhLmNoYXJhY3Rlck5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLmFjY291bnROYW1lLFxyXG4gICAgICAgICAgICBzZXJ2ZXJOYW1lOiAn5q2j5byP5pyNLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtWm9uZU5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtTmFtZVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocGFyc2VJbnQocmVzLmRhdGEuZGF0YS5yZWFsbVR5cGUpID09IDIpIHtcclxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgIFJlYWxtVHlwZTogcGFyc2VJbnQocmVzLmRhdGEuZGF0YS5yZWFsbVR5cGUpLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXJOYW1lOiByZXMuZGF0YS5kYXRhLmNoYXJhY3Rlck5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLmFjY291bnROYW1lLFxyXG4gICAgICAgICAgICBzZXJ2ZXJOYW1lOiAn5oCA5pen5pyNLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtWm9uZU5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtTmFtZVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJTcGVjaWFsaXphdGlvbi5zcGxpdCgnIycpLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICBsZXQgdGVtcCA9IHguc3BsaXQoJzonKTtcclxuICAgICAgICAgIGxldCBkYXRhID0ge1xyXG4gICAgICAgICAgICBzcGVjaWFsaXphdGlvbnMgOiBuZXcgQXJyYXk8e25hbWU6IHN0cmluZywgdmFsdWU6IG51bWJlcn0+KCksXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgaWYocGFyc2VJbnQodGVtcFsxXSkgPiAwKSB7XHJcbiAgICAgICAgICAgIGRhdGEuc3BlY2lhbGl6YXRpb25zLnB1c2goe25hbWU6IHRlbXBbMF0sIHZhbHVlOiBwYXJzZUludCh0ZW1wWzFdKX0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICB0aGlzLmdldEF2YWlsYWJsZUNvdXBvbigpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLm1vZGUgPT0gJ0RldGFpbCcpIHtcclxuICAgICAgYXBwLnJlcXVlc3RGdW5jUHJvbWlzZSgnL29yZGVyL29yZGVyRGV0YWlsJywge3VzZXJJZDogdGhpcy5kYXRhLnVzZXJJZCwgb3JkZXJJZDogdGhpcy5kYXRhLm9yZGVySWR9LCAnR0VUJylcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICBjaGFyYWN0ZXJJZDogcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJJZCxcclxuICAgICAgICAgIGNoYXJhY3Rlck5hbWU6IHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVySW5mbyxcclxuICAgICAgICAgIHNlcnZlck5hbWU6IHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyUmVhbG0sXHJcbiAgICAgICAgICBhY2NvdW50TmFtZTogcmVzLmRhdGEuZGF0YS5hY2NvdW50SWQsXHJcbiAgICAgICAgICBhY2NvdW50UGFzc3dvcmQ6IHJlcy5kYXRhLmRhdGEuYWNjb3VudFBhc3N3b3JkLFxyXG4gICAgICAgICAgb3JkZXJDYXRhbG9nOiByZXMuZGF0YS5kYXRhLm9yZGVyQ2F0YWxvZyxcclxuICAgICAgICAgIHBob25lTnVtYmVyOiByZXMuZGF0YS5kYXRhLnBob25lLFxyXG4gICAgICAgICAgbW9uZXk6IHJlcy5kYXRhLmRhdGEub3JkZXJNb25leSxcclxuICAgICAgICAgIG9yaWdpbk1vbmV5OiByZXMuZGF0YS5kYXRhLm9yZGVyTW9uZXksXHJcbiAgICAgICAgICBoYXNHdWFyZDogcmVzLmRhdGEuZGF0YS5zYXZlZ3VhcmQsXHJcbiAgICAgICAgICBub3RlOiByZXMuZGF0YS5kYXRhLm5vdGUsXHJcbiAgICAgICAgICBvcmRlclN0YXR1czogcmVzLmRhdGEuZGF0YS5vcmRlclN0YXR1c1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyU3BlYy5zcGxpdCgnIycpLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICBsZXQgdGVtcCA9IHguc3BsaXQoJzonKTtcclxuICAgICAgICAgIGxldCBkYXRhID0ge1xyXG4gICAgICAgICAgICBzcGVjaWFsaXphdGlvbnMgOiBuZXcgQXJyYXk8e25hbWU6IHN0cmluZywgdmFsdWU6IG51bWJlcn0+KCksXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgZGF0YS5zcGVjaWFsaXphdGlvbnMucHVzaCh7bmFtZTogdGVtcFswXSwgdmFsdWU6IHBhcnNlSW50KHRlbXBbMV0pfSk7XHJcbiAgICAgICAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgaW5wdXROb3RlKGU6IGFueSkge1xyXG4gICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgbm90ZTogZS5kZXRhaWwudmFsdWVcclxuICAgIH0pXHJcbiAgfSxcclxuICBpbnB1dEFjY291bnROYW1lKGUpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIGFjY291bnROYW1lOiBlLmRldGFpbC52YWx1ZVxyXG4gICAgfSlcclxuICB9LFxyXG4gIFNob3dQYXNzd29yZCgpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIHNob3dQYXNzd29yZDogIXRoaXMuZGF0YS5zaG93UGFzc3dvcmRcclxuICAgIH0pXHJcbiAgfSxcclxuICBpbnB1dFBhc3N3b3JkKGUpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIGFjY291bnRQYXNzd29yZDogZS5kZXRhaWwudmFsdWVcclxuICAgIH0pXHJcbiAgfSxcclxuICBpbnB1dFBob25lTnVtYmVyKGUpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIHBob25lTnVtYmVyOiBlLmRldGFpbC52YWx1ZVxyXG4gICAgfSlcclxuICB9LFxyXG4gIGNoYW5nZUd1YXJkKGUpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIGhhc0d1YXJkOiBlLmRldGFpbC52YWx1ZVxyXG4gICAgfSlcclxuICB9LFxyXG4gIGdldEF2YWlsYWJsZUNvdXBvbigpIHtcclxuICAgIGFwcC5yZXF1ZXN0RnVuY1Byb21pc2UoJy9vcmRlci9hdmFpbGFibGVDb3Vwb24nLCB7dXNlcklkOiB0aGlzLmRhdGEudXNlcklkfSwgJ0dFVCcpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmKHJlcy5kYXRhLnN1Y2Nlc3MpIHtcclxuICAgICAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgICAgIGNvdXBvbnM6IG5ldyBBcnJheTx7aWQ6IHN0cmluZywgc3RhdHVzOiBudW1iZXIsIG5hbWU6IHN0cmluZywgZGlzY291bnQ6IG51bWJlciwgZXhwaXJlVGltZTogRGF0ZX0+KClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRhdGEuY291cG9ucy5wdXNoKHtpZDogJ251bGwnLCBzdGF0dXM6IDEsIG5hbWU6ICfkuI3kvb/nlKjkvJjmg6DliLgnLCBkaXNjb3VudDogMCwgZXhwaXJlVGltZTogbmV3IERhdGUoKX0pXHJcbiAgICAgICAgcmVzLmRhdGEuY291cG9uTGlzdC5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgaWYoeC5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICBkYXRhLmNvdXBvbnMucHVzaCh7aWQ6IHguY291cG9uSWQsIHN0YXR1czogeC5jb3Vwb25TdGF0dXMsIG5hbWU6IHguY291cG9uTmFtZSwgZGlzY291bnQ6IHguY291cG9uRGlzY291bnQsIGV4cGlyZVRpbWU6IHguZXhwaXJlVGltZX0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gICAgICAgIHRoaXMuY2FsY01vbmV5KCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgY291cG9uQ2hhbmdlKGUpIHtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIGNvdXBvbkluZGV4OiBlLmRldGFpbC52YWx1ZVxyXG4gICAgfSlcclxuICAgIHRoaXMuY2FsY01vbmV5KCk7XHJcbiAgfSxcclxuICBjYWxjTW9uZXkoKSB7XHJcbiAgICBpZih0aGlzLmRhdGEuY291cG9uc1t0aGlzLmRhdGEuY291cG9uSW5kZXhdLmlkICE9ICdudWxsJykge1xyXG4gICAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgICBtb25leTogdGhpcy5kYXRhLm1vbmV5LFxyXG4gICAgICAgIG9yaWdpbk1vbmV5OiB0aGlzLmRhdGEubW9uZXlcclxuICAgICAgfVxyXG4gICAgICBkYXRhLm1vbmV5ID0gdGhpcy5kYXRhLm1vbmV5ICogdGhpcy5kYXRhLmNvdXBvbnNbdGhpcy5kYXRhLmNvdXBvbkluZGV4XS5kaXNjb3VudFxyXG4gICAgICB0aGlzLnNldERhdGEoZGF0YSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBkYXRhID0ge1xyXG4gICAgICAgIG1vbmV5OiB0aGlzLmRhdGEub3JpZ2luTW9uZXksXHJcbiAgICAgICAgb3JpZ2luTW9uZXk6IHRoaXMuZGF0YS5vcmlnaW5Nb25leVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBmb3JtU3VibWl0KGUpIHtcclxuICAgIGNvbnN0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBzcGVjU3RyaW5nID0gJyc7XHJcbiAgICBsZXQgY2hlY2tWYWxpZCA9IHRydWU7XHJcbiAgICB0aGlzLmRhdGEuc3BlY2lhbGl6YXRpb25zLmV2ZXJ5KHggPT4ge1xyXG4gICAgICBpZiAoKCFpc05hTih4LnZhbHVlKSAmJiB4LnZhbHVlID4gMCkpIHtcclxuICAgICAgICBzcGVjU3RyaW5nICs9IHgubmFtZSArICc6JyArIHgudmFsdWUudG9TdHJpbmcoKSArICcjJ1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmICghaXNOYU4oeC52YWx1ZSkgJiYgeC52YWx1ZSA8PSAwKSB7XHJcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xyXG4gICAgICAgICAgICB0aXRsZTogJ+S4k+eyvuetiee6p+W/hemhu+Wkp+S6jjAnLFxyXG4gICAgICAgICAgICBpY29uOiAnbm9uZScsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGNoZWNrVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICAgICAgdGl0bGU6ICfor7fovpPlhaXkuJPnsr7nrYnnuqcnLFxyXG4gICAgICAgICAgICBpY29uOiAnbm9uZScsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hlY2tWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZighY2hlY2tWYWxpZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBzcGVjU3RyaW5nID0gc3BlY1N0cmluZy5zdWJzdHJpbmcoMCwgc3BlY1N0cmluZy5sZW5ndGggLSAxKTtcclxuXHJcbiAgICBsZXQgZGV0YWlsRGF0YSA9IHtcclxuICAgICAgb3JkZXJJZDogdGhpcy5kYXRhLm9yZGVySWQgIT0gJycgPyB0aGlzLmRhdGEub3JkZXJJZDogJycsXHJcbiAgICAgIHVzZXJJZDogdGhpcy5kYXRhLnVzZXJJZCxcclxuICAgICAgb3JkZXJUeXBlOiAxLFxyXG4gICAgICBvcmRlclNlcnZlcjogdGhpcy5kYXRhLlJlYWxtVHlwZSxcclxuICAgICAgb3JkZXJDYXRhbG9nOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nLFxyXG4gICAgICBvcmRlckNhdGFsb2cxOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nMSxcclxuICAgICAgb3JkZXJDYXRhbG9nMjogdGhpcy5kYXRhLm9yZGVyQ2F0YWxvZzIsXHJcbiAgICAgIG9yZGVyQ2F0YWxvZzM6IHRoaXMuZGF0YS5vcmRlckNhdGFsb2czLFxyXG4gICAgICBvcmRlck1vbmV5OiB0aGlzLmRhdGEubW9uZXksXHJcbiAgICAgIGNoYXJhY3RlcklkOiB0aGlzLmRhdGEuY2hhcmFjdGVySWQsXHJcbiAgICAgIGNoYXJhY3RlckluZm86IHRoaXMuZGF0YS5jaGFyYWN0ZXJOYW1lLFxyXG4gICAgICBjaGFyYWN0ZXJSZWFsbTogdGhpcy5kYXRhLnNlcnZlck5hbWUsXHJcbiAgICAgIGNoYXJhY3RlclNwZWM6IHNwZWNTdHJpbmcsXHJcbiAgICAgIGFjY291bnRJZDogZS5kZXRhaWwudmFsdWUuYWNjb3VudE5hbWUsXHJcbiAgICAgIGFjY291bnRQYXNzd29yZDogZS5kZXRhaWwudmFsdWUuYWNjb3VudFBhc3N3b3JkLFxyXG4gICAgICBzYXZlZ3VhcmQ6IHRoaXMuZGF0YS5oYXNHdWFyZCxcclxuICAgICAgcGhvbmU6IGUuZGV0YWlsLnZhbHVlLnBob25lTnVtYmVyLFxyXG4gICAgICBub3RlOiBlLmRldGFpbC52YWx1ZS5ub3RlLFxyXG4gICAgICByZW1vdGVBZGRyOiAnJyxcclxuICAgICAgY291cG9uSWQ6ICcnXHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgaWYgKHRoaXMuZGF0YS5vcmRlclN0YXR1cyA9PSA5KSB7XHJcbiAgICAgIGRldGFpbERhdGEuY291cG9uSWQgPSB0aGlzLmRhdGEuY291cG9uc1t0aGlzLmRhdGEuY291cG9uSW5kZXhdLmlkICE9ICdudWxsJyA/IHRoaXMuZGF0YS5jb3Vwb25zW3RoaXMuZGF0YS5jb3Vwb25JbmRleF0uaWQgOiAnJ1xyXG4gICAgfVxyXG4gICAgaWYgKGRldGFpbERhdGEuYWNjb3VudElkID09IFwiXCIpIHtcclxuICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICB0aXRsZTogJ+ivt+i+k+WFpei0puWPtycsXHJcbiAgICAgICAgaWNvbjogJ25vbmUnLFxyXG4gICAgICAgIG1hc2s6IHRydWUsXHJcbiAgICAgICAgZHVyYXRpb246IDEwMDBcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChkZXRhaWxEYXRhLmFjY291bnRQYXNzd29yZCA9PSBcIlwiKSB7XHJcbiAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgdGl0bGU6ICfor7fovpPlhaXlr4bnoIEnLFxyXG4gICAgICAgIGljb246ICdub25lJyxcclxuICAgICAgICBtYXNrOiB0cnVlLFxyXG4gICAgICAgIGR1cmF0aW9uOiAxMDAwXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoZGV0YWlsRGF0YS5waG9uZSA9PSBcIlwiKSB7XHJcbiAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgdGl0bGU6ICfor7fovpPlhaXmiYvmnLrlj7fnoIEnLFxyXG4gICAgICAgIGljb246ICdub25lJyxcclxuICAgICAgICBtYXNrOiB0cnVlLFxyXG4gICAgICAgIGR1cmF0aW9uOiAxMDAwXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgd3gucmVxdWVzdCh7XHJcbiAgICAgIHVybDogJ2h0dHBzOi8vcHYuc29odS5jb20vY2l0eWpzb24/aWU9dXRmLTgnLFxyXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUuZGF0YSk7XHJcbiAgICAgICAgY29uc3QgaXBBZGRyZXNzID0gZS5kYXRhLnNwbGl0KCcgJylbNF0ucmVwbGFjZSgnXCInLCcnKS5yZXBsYWNlKCdcIicsICcnKS5yZXBsYWNlKCcsJywgJycpXHJcbiAgICAgICAgZGV0YWlsRGF0YS5yZW1vdGVBZGRyID0gaXBBZGRyZXNzXHJcblxyXG4gICAgICAgIGFwcC5yZXF1ZXN0RnVuYygnL29yZGVyL3NhdmVPcmRlcicsIGRldGFpbERhdGEsICdQT1NUJywgcmVzID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKTtcclxuICAgICAgICAgIGlmIChyZXMuZGF0YS5zdWNjZXNzID09IHRydWUpIHtcclxuICAgICAgICAgICAgaWYocmVzLmRhdGEucGF5SW5mbykge1xyXG4gICAgICAgICAgICAgIHd4LnJlcXVlc3RQYXltZW50KHtcclxuICAgICAgICAgICAgICAgICd0aW1lU3RhbXAnOiByZXMuZGF0YS5wYXlJbmZvLnRpbWVTdGFtcC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgJ25vbmNlU3RyJzogcmVzLmRhdGEucGF5SW5mby5ub25jZVN0cixcclxuICAgICAgICAgICAgICAgICdwYWNrYWdlJzogcmVzLmRhdGEucGF5SW5mby5wYWNrYWdlLFxyXG4gICAgICAgICAgICAgICAgJ3NpZ25UeXBlJzogcmVzLmRhdGEucGF5SW5mby5zaWduVHlwZSxcclxuICAgICAgICAgICAgICAgICdwYXlTaWduJzogcmVzLmRhdGEucGF5SW5mby5zaWduLFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5pSv5LuY5oiQ5YqfJyxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsdGE6IDFcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jlpLHotKUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdub25lJyxcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwMFxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ0RldGFpbCdcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgX3RoaXMub25TaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiByZXMuZGF0YS5tc2csXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMFxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgICAgICAgdGl0bGU6IHJlcy5kYXRhLm1zZyxcclxuICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXHJcbiAgICAgICAgICAgICAgZHVyYXRpb246IDEwMDBcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH0sXHJcblxyXG4gIGNhbmNlbE9yZGVyKCkge1xyXG4gICAgY29uc3QgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGRldGFpbERhdGEgPSB7XHJcbiAgICAgIG9yZGVySWQ6IHRoaXMuZGF0YS5vcmRlcklkLFxyXG4gICAgICB1c2VySWQ6IHRoaXMuZGF0YS51c2VySWRcclxuICAgIH1cclxuICAgIGFwcC5yZXF1ZXN0RnVuYygnL29yZGVyL2NhbmNlbE9yZGVyJywgZGV0YWlsRGF0YSwgJ1BPU1QnLCByZXMgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XHJcbiAgICAgIGlmIChyZXMuZGF0YS5zdWNjZXNzID09IHRydWUpIHtcclxuICAgICAgICB3eC5zaG93VG9hc3Qoe1xyXG4gICAgICAgICAgdGl0bGU6ICflj5bmtojorqLljZXmiJDlip8nLFxyXG4gICAgICAgICAgaWNvbjogJ25vbmUnLFxyXG4gICAgICAgICAgZHVyYXRpb246IDE1MDBcclxuICAgICAgICB9KTtcclxuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xyXG4gICAgICAgICAgZGVsdGE6IDFcclxuICAgICAgICB9KVxyXG4gICAgICAgIF90aGlzLm9uU2hvdygpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxufSlcclxuIl19