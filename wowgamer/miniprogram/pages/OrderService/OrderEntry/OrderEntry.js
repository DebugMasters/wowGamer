"use strict";
const app = getApp();
Page({
    data: {
        mode: '',
        userId: '',
        orderId: '',
        characterName: 'qqq/jzhoou',
        RealmType: 1,
        characterId: '',
        serverName: '',
        showPassword: false,
        accountName: '',
        accountPassword: '',
        phoneNumber: '',
        hasGuard: 1,
        orderCatalog: '',
        orderCatalog1: '',
        orderCatalog2: '',
        orderCatalog3: '',
        money: 0,
        specializations: new Array(),
    },
    onLoad(options) {
        const data = JSON.parse(options.data);
        if (data.mode == 'AddNew') {
            this.setData({
                mode: data.mode,
                userId: wx.getStorageSync('userId'),
                characterName: data.characterName,
                orderCatalog: data.orderCatalog,
                orderCatalog1: data.orderCatalog1,
                orderCatalog2: data.orderCatalog2,
                orderCatalog3: data.orderCatalog3,
                money: data.money,
                characterId: data.characterId
            });
        }
        if (data.mode == 'Detail') {
            this.setData({
                mode: data.mode,
                userId: data.userId,
                orderId: data.orderId
            });
        }
    },
    onShow() {
        const _this = this;
        if (this.data.mode == 'AddNew') {
            app.requestFuncPromise('/user/getCharacter', { characterId: this.data.characterId }, 'GET')
                .then(res => {
                if (res.data.data.characterRealmType == 1) {
                    this.setData({
                        RealmType: res.data.data.characterRealmType,
                        serverName: '正式服'
                    });
                }
                if (res.data.data.characterRealmType == 2) {
                    this.setData({
                        RealmType: res.data.data.characterRealmType,
                        serverName: '怀旧服'
                    });
                }
                res.data.data.characterSpecialization.split('#').forEach(x => {
                    let temp = x.split(':');
                    let data = {
                        specializations: _this.data.specializations
                    };
                    if (parseInt(temp[1]) > 0) {
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                    }
                    this.setData(data);
                });
            })
                .catch(res => {
                console.log(res);
            });
        }
        if (this.data.mode == 'Detail') {
            app.requestFuncPromise('/order/orderDetail', { userId: this.data.userId, orderId: this.data.orderId }, 'GET')
                .then((res) => {
                this.setData({
                    characterName: res.data.data.characterName + '/',
                    accountName: res.data.data.accountId,
                    orderCatalog: res.data.data.orderCatalog,
                    phoneNumber: res.data.data.phone,
                    money: res.data.data.orderMoney,
                    hasGuard: res.data.data.saveguard,
                    note: res.data.data.note
                }),
                    res.data.data.characterSpec.split('#').forEach(x => {
                        let temp = x.split(':');
                        let data = {
                            specializations: _this.data.specializations
                        };
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                        this.setData(data);
                    });
            })
                .catch((err) => {
            });
        }
    },
    inputAccountName(e) {
        this.setData({
            accountName: e.detail.value
        });
    },
    ShowPassword() {
        this.setData({
            showPassword: !this.data.showPassword
        });
    },
    inputPassword(e) {
        this.setData({
            accountPassword: e.detail.value
        });
    },
    inputPhoneNumber(e) {
        this.setData({
            phoneNumber: e.detail.value
        });
    },
    changeGuard(e) {
        this.setData({
            hasGuard: e.detail.value
        });
    },
    formSubmit(e) {
        const _this = this;
        let specString = '';
        let checkValid = true;
        this.data.specializations.every(x => {
            if ((!isNaN(x.value) && x.value > 0)) {
                specString += x.name + ':' + x.value.toString() + '#';
                return true;
            }
            else {
                if (!isNaN(x.value) && x.value <= 0) {
                    wx.showToast({
                        title: '专精等级必须大于0',
                        icon: 'none',
                        duration: 1000
                    });
                    checkValid = false;
                    return false;
                }
                else {
                    wx.showToast({
                        title: '请输入专精等级',
                        icon: 'none',
                        duration: 1000
                    });
                }
                checkValid = false;
                return false;
            }
        });
        if (!checkValid) {
            return;
        }
        specString = specString.substring(0, specString.length - 1);
        let detailData = {
            userId: this.data.userId,
            orderType: 1,
            orderServer: this.data.RealmType,
            orderCatalog: this.data.orderCatalog,
            orderCatalog1: this.data.orderCatalog1,
            orderCatalog2: this.data.orderCatalog2,
            orderCatalog3: this.data.orderCatalog3,
            orderMoney: this.data.money,
            characterId: this.data.characterId,
            characterSpec: specString,
            accountId: e.detail.value.accountName,
            accountPassword: e.detail.value.accountPassword,
            saveguard: this.data.hasGuard,
            phone: e.detail.value.phoneNumber,
            note: e.detail.value.note,
            remoteAddr: '12345'
        };
        if (detailData.accountId == "") {
            wx.showToast({
                title: '请输入账号',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        if (detailData.accountPassword == "") {
            wx.showToast({
                title: '请输入密码',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        if (detailData.phone == "") {
            wx.showToast({
                title: '请输入手机号码',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        app.requestFunc('/order/saveOrder', detailData, 'POST', res => {
            console.log(res.data);
            if (res.data.success == true) {
                wx.showToast({
                    title: '下单完成',
                    icon: 'success',
                    duration: 1000
                });
                wx.navigateBack({
                    delta: 1
                });
            }
            else {
                wx.showToast({
                    title: res.data.msg,
                    icon: 'none',
                    duration: 1000
                });
            }
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JkZXJFbnRyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9yZGVyRW50cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sRUFBYyxDQUFBO0FBRWhDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLElBQUksRUFBRSxFQUFFO1FBQ1IsTUFBTSxFQUFFLEVBQUU7UUFDVixPQUFPLEVBQUUsRUFBRTtRQUNYLGFBQWEsRUFBRSxZQUFZO1FBQzNCLFNBQVMsRUFBRSxDQUFDO1FBQ1osV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVLEVBQUUsRUFBRTtRQUNkLFlBQVksRUFBRSxLQUFLO1FBQ25CLFdBQVcsRUFBRSxFQUFFO1FBQ2YsZUFBZSxFQUFFLEVBQUU7UUFDbkIsV0FBVyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsQ0FBQztRQUNYLFlBQVksRUFBRSxFQUFFO1FBQ2hCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLEtBQUssRUFBRSxDQUFDO1FBQ1IsZUFBZSxFQUFFLElBQUksS0FBSyxFQUFpQztLQUM1RDtJQUNELE1BQU0sQ0FBQyxPQUFPO1FBQ1osTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBUyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsSUFBRyxJQUFJLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRTtZQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtnQkFDZixNQUFNLEVBQUUsRUFBRSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUM7Z0JBQ25DLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtnQkFDakMsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZO2dCQUMvQixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7Z0JBQ2pDLGFBQWEsRUFBRSxJQUFJ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LE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxFQUFFO2dCQUM1QixFQUFFLENBQUMsU0FBUyxDQUFDO29CQUNYLEtBQUssRUFBRSxNQUFNO29CQUNiLElBQUksRUFBRSxTQUFTO29CQUNmLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQTtnQkFDRixFQUFFLENBQUMsWUFBWSxDQUFDO29CQUNkLEtBQUssRUFBRSxDQUFDO2lCQUNULENBQUMsQ0FBQTthQUNIO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1gsS0FBSyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRztvQkFDbkIsSUFBSSxFQUFFLE1BQU07b0JBQ1osUUFBUSxFQUFFLElBQUk7aUJBQ2YsQ0FBQyxDQUFBO2FBQ0g7UUFDSCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyDojrflj5blupTnlKjlrp7kvotcbmNvbnN0IGFwcCA9IGdldEFwcDxJQXBwT3B0aW9uPigpXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgbW9kZTogJycsXG4gICAgdXNlcklkOiAnJyxcbiAgICBvcmRlcklkOiAnJyxcbiAgICBjaGFyYWN0ZXJOYW1lOiAncXFxL2p6aG9vdScsXG4gICAgUmVhbG1UeXBlOiAxLFxuICAgIGNoYXJhY3RlcklkOiAnJyxcbiAgICBzZXJ2ZXJOYW1lOiAnJyxcbiAgICBzaG93UGFzc3dvcmQ6IGZhbHNlLFxuICAgIGFjY291bnROYW1lOiAnJyxcbiAgICBhY2NvdW50UGFzc3dvcmQ6ICcnLFxuICAgIHBob25lTnVtYmVyOiAnJyxcbiAgICBoYXNHdWFyZDogMSxcbiAgICBvcmRlckNhdGFsb2c6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzE6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzI6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzM6ICcnLFxuICAgIG1vbmV5OiAwLFxuICAgIHNwZWNpYWxpemF0aW9uczogbmV3IEFycmF5PHtuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXJ9PigpLFxuICB9LFxuICBvbkxvYWQob3B0aW9ucykge1xuICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKDxzdHJpbmc+b3B0aW9ucy5kYXRhKTtcbiAgICBpZihkYXRhLm1vZGUgPT0gJ0FkZE5ldycpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIG1vZGU6IGRhdGEubW9kZSxcbiAgICAgICAgdXNlcklkOiB3eC5nZXRTdG9yYWdlU3luYygndXNlcklkJyksXG4gICAgICAgIGNoYXJhY3Rlck5hbWU6IGRhdGEuY2hhcmFjdGVyTmFtZSxcbiAgICAgICAgb3JkZXJDYXRhbG9nOiBkYXRhLm9yZGVyQ2F0YWxvZyxcbiAgICAgICAgb3JkZXJDYXRhbG9nMTogZGF0YS5vcmRlckNhdGFsb2cxLFxuICAgICAgICBvcmRlckNhdGFsb2cyOiBkYXRhLm9yZGVyQ2F0YWxvZzIsXG4gICAgICAgIG9yZGVyQ2F0YWxvZzM6IGRhdGEub3JkZXJDYXRhbG9nMyxcbiAgICAgICAgbW9uZXk6IGRhdGEubW9uZXksXG4gICAgICAgIGNoYXJhY3RlcklkOiBkYXRhLmNoYXJhY3RlcklkXG4gICAgICB9KSBcbiAgICB9XG4gICAgaWYoZGF0YS5tb2RlID09ICdEZXRhaWwnKSB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBtb2RlOiBkYXRhLm1vZGUsXG4gICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgIG9yZGVySWQ6IGRhdGEub3JkZXJJZFxuICAgICAgfSkgXG4gICAgfVxuICB9LFxuICBvblNob3coKSB7XG4gICAgY29uc3QgX3RoaXMgPSB0aGlzXG4gICAgaWYodGhpcy5kYXRhLm1vZGUgPT0gJ0FkZE5ldycpIHtcbiAgICAgIGFwcC5yZXF1ZXN0RnVuY1Byb21pc2UoJy91c2VyL2dldENoYXJhY3RlcicsIHtjaGFyYWN0ZXJJZDogdGhpcy5kYXRhLmNoYXJhY3RlcklkfSwgJ0dFVCcpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBpZihyZXMuZGF0YS5kYXRhLmNoYXJhY3RlclJlYWxtVHlwZSA9PSAxKSB7XG4gICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIFJlYWxtVHlwZTogcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJSZWFsbVR5cGUsXG4gICAgICAgICAgICBzZXJ2ZXJOYW1lOiAn5q2j5byP5pyNJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYocmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJSZWFsbVR5cGUgPT0gMikge1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBSZWFsbVR5cGU6IHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyUmVhbG1UeXBlLFxuICAgICAgICAgICAgc2VydmVyTmFtZTogJ+aAgOaXp+acjSdcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyU3BlY2lhbGl6YXRpb24uc3BsaXQoJyMnKS5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgIGxldCB0ZW1wID0geC5zcGxpdCgnOicpO1xuICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgc3BlY2lhbGl6YXRpb25zIDogX3RoaXMuZGF0YS5zcGVjaWFsaXphdGlvbnNcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmKHBhcnNlSW50KHRlbXBbMV0pID4gMCkge1xuICAgICAgICAgICAgZGF0YS5zcGVjaWFsaXphdGlvbnMucHVzaCh7bmFtZTogdGVtcFswXSwgdmFsdWU6IHBhcnNlSW50KHRlbXBbMV0pfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHJlcyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICB9KVxuICAgIH1cbiAgICBpZih0aGlzLmRhdGEubW9kZSA9PSAnRGV0YWlsJykge1xuICAgICAgYXBwLnJlcXVlc3RGdW5jUHJvbWlzZSgnL29yZGVyL29yZGVyRGV0YWlsJywge3VzZXJJZDogdGhpcy5kYXRhLnVzZXJJZCwgb3JkZXJJZDogdGhpcy5kYXRhLm9yZGVySWR9LCAnR0VUJylcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBjaGFyYWN0ZXJOYW1lOiByZXMuZGF0YS5kYXRhLmNoYXJhY3Rlck5hbWUgKyAnLycsXG4gICAgICAgICAgYWNjb3VudE5hbWU6IHJlcy5kYXRhLmRhdGEuYWNjb3VudElkLFxuICAgICAgICAgIG9yZGVyQ2F0YWxvZzogcmVzLmRhdGEuZGF0YS5vcmRlckNhdGFsb2csXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHJlcy5kYXRhLmRhdGEucGhvbmUsXG4gICAgICAgICAgbW9uZXk6IHJlcy5kYXRhLmRhdGEub3JkZXJNb25leSxcbiAgICAgICAgICBoYXNHdWFyZDogcmVzLmRhdGEuZGF0YS5zYXZlZ3VhcmQsXG4gICAgICAgICAgbm90ZTogcmVzLmRhdGEuZGF0YS5ub3RlXG4gICAgICAgIH0pLFxuICAgICAgICByZXMuZGF0YS5kYXRhLmNoYXJhY3RlclNwZWMuc3BsaXQoJyMnKS5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgIGxldCB0ZW1wID0geC5zcGxpdCgnOicpO1xuICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgc3BlY2lhbGl6YXRpb25zIDogX3RoaXMuZGF0YS5zcGVjaWFsaXphdGlvbnNcbiAgICAgICAgICB9O1xuICAgICAgICAgIGRhdGEuc3BlY2lhbGl6YXRpb25zLnB1c2goe25hbWU6IHRlbXBbMF0sIHZhbHVlOiBwYXJzZUludCh0ZW1wWzFdKX0pO1xuICAgICAgICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgaW5wdXRBY2NvdW50TmFtZShlKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGFjY291bnROYW1lOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIFNob3dQYXNzd29yZCgpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgc2hvd1Bhc3N3b3JkOiAhdGhpcy5kYXRhLnNob3dQYXNzd29yZFxuICAgIH0pXG4gIH0sXG4gIGlucHV0UGFzc3dvcmQoZSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBhY2NvdW50UGFzc3dvcmQ6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuICBpbnB1dFBob25lTnVtYmVyKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcGhvbmVOdW1iZXI6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuICBjaGFuZ2VHdWFyZChlKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGhhc0d1YXJkOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG5cblxuICBmb3JtU3VibWl0KGUpIHtcbiAgICBjb25zdCBfdGhpcyA9IHRoaXM7XG4gICAgbGV0IHNwZWNTdHJpbmcgPSAnJztcbiAgICBsZXQgY2hlY2tWYWxpZCA9IHRydWU7XG4gICAgdGhpcy5kYXRhLnNwZWNpYWxpemF0aW9ucy5ldmVyeSh4ID0+IHtcbiAgICAgIGlmICgoIWlzTmFOKHgudmFsdWUpICYmIHgudmFsdWUgPiAwKSkge1xuICAgICAgICBzcGVjU3RyaW5nICs9IHgubmFtZSArICc6JyArIHgudmFsdWUudG9TdHJpbmcoKSArICcjJ1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghaXNOYU4oeC52YWx1ZSkgJiYgeC52YWx1ZSA8PSAwKSB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiAn5LiT57K+562J57qn5b+F6aG75aSn5LqOMCcsXG4gICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNoZWNrVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiAn6K+36L6T5YWl5LiT57K+562J57qnJyxcbiAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2hlY2tWYWxpZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYoIWNoZWNrVmFsaWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3BlY1N0cmluZyA9IHNwZWNTdHJpbmcuc3Vic3RyaW5nKDAsIHNwZWNTdHJpbmcubGVuZ3RoIC0gMSk7XG5cbiAgICBsZXQgZGV0YWlsRGF0YSA9IHtcbiAgICAgIHVzZXJJZDogdGhpcy5kYXRhLnVzZXJJZCxcbiAgICAgIG9yZGVyVHlwZTogMSxcbiAgICAgIG9yZGVyU2VydmVyOiB0aGlzLmRhdGEuUmVhbG1UeXBlLFxuICAgICAgb3JkZXJDYXRhbG9nOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nLFxuICAgICAgb3JkZXJDYXRhbG9nMTogdGhpcy5kYXRhLm9yZGVyQ2F0YWxvZzEsXG4gICAgICBvcmRlckNhdGFsb2cyOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nMixcbiAgICAgIG9yZGVyQ2F0YWxvZzM6IHRoaXMuZGF0YS5vcmRlckNhdGFsb2czLFxuICAgICAgb3JkZXJNb25leTogdGhpcy5kYXRhLm1vbmV5LFxuICAgICAgY2hhcmFjdGVySWQ6IHRoaXMuZGF0YS5jaGFyYWN0ZXJJZCxcbiAgICAgIGNoYXJhY3RlclNwZWM6IHNwZWNTdHJpbmcsXG4gICAgICBhY2NvdW50SWQ6IGUuZGV0YWlsLnZhbHVlLmFjY291bnROYW1lLFxuICAgICAgYWNjb3VudFBhc3N3b3JkOiBlLmRldGFpbC52YWx1ZS5hY2NvdW50UGFzc3dvcmQsXG4gICAgICBzYXZlZ3VhcmQ6IHRoaXMuZGF0YS5oYXNHdWFyZCxcbiAgICAgIHBob25lOiBlLmRldGFpbC52YWx1ZS5waG9uZU51bWJlcixcbiAgICAgIG5vdGU6IGUuZGV0YWlsLnZhbHVlLm5vdGUsXG4gICAgICByZW1vdGVBZGRyOiAnMTIzNDUnXG4gICAgfVxuXG4gICAgaWYgKGRldGFpbERhdGEuYWNjb3VudElkID09IFwiXCIpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+36L6T5YWl6LSm5Y+3JyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChkZXRhaWxEYXRhLmFjY291bnRQYXNzd29yZCA9PSBcIlwiKSB7XG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+ivt+i+k+WFpeWvhueggScsXG4gICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZGV0YWlsRGF0YS5waG9uZSA9PSBcIlwiKSB7XG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+ivt+i+k+WFpeaJi+acuuWPt+eggScsXG4gICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBhcHAucmVxdWVzdEZ1bmMoJy9vcmRlci9zYXZlT3JkZXInLCBkZXRhaWxEYXRhLCAnUE9TVCcsIHJlcyA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICBpZiAocmVzLmRhdGEuc3VjY2VzcyA9PSB0cnVlKSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6ICfkuIvljZXlrozmiJAnLFxuICAgICAgICAgIGljb246ICdzdWNjZXNzJyxcbiAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICB9KVxuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOiByZXMuZGF0YS5tc2csXG4gICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfSxcbn0pXG4iXX0=