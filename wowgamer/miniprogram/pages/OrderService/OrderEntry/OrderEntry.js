"use strict";
const app = getApp();
Page({
    data: {
        userId: '',
        characterName: 'qqq/jzhoou',
        RealmType: 1,
        characterId: '',
        serverName: '',
        showPassword: false,
        accountName: '',
        accountPassword: '',
        phoneNumber: '',
        hasGuard: 1,
        orderCatalog: '',
        orderCatalog1: '',
        orderCatalog2: '',
        orderCatalog3: '',
        money: 0,
        specializations: new Array(),
    },
    onLoad(options) {
        const data = JSON.parse(options.data);
        this.setData({
            userId: wx.getStorageSync('userId'),
            characterName: data.characterName,
            orderCatalog: data.orderCatalog,
            orderCatalog1: data.orderCatalog1,
            orderCatalog2: data.orderCatalog2,
            orderCatalog3: data.orderCatalog3,
            money: data.money,
            characterId: data.characterId
        });
    },
    onShow() {
        const _this = this;
        app.requestFuncPromise('/user/getCharacter', { characterId: this.data.characterId }, 'GET')
            .then(res => {
            if (res.data.data.characterRealmType == 1) {
                this.setData({
                    RealmType: res.data.data.characterRealmType,
                    serverName: '正式服'
                });
            }
            if (res.data.data.characterRealmType == 2) {
                this.setData({
                    RealmType: res.data.data.characterRealmType,
                    serverName: '怀旧服'
                });
            }
            res.data.data.characterSpecialization.split('#').forEach(x => {
                let temp = x.split(':');
                let data = {
                    specializations: _this.data.specializations
                };
                if (parseInt(temp[1]) > 0) {
                    data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                }
                this.setData(data);
            });
        })
            .catch(res => {
            console.log(res);
        });
    },
    inputAccountName(e) {
        this.setData({
            accountName: e.detail.value
        });
    },
    ShowPassword() {
        this.setData({
            showPassword: !this.data.showPassword
        });
    },
    inputPassword(e) {
        this.setData({
            accountPassword: e.detail.value
        });
    },
    inputPhoneNumber(e) {
        this.setData({
            phoneNumber: e.detail.value
        });
    },
    changeGuard(e) {
        this.setData({
            hasGuard: e.detail.value
        });
    },
    formSubmit(e) {
        const _this = this;
        let specString = '';
        let checkValid = true;
        this.data.specializations.every(x => {
            if ((!isNaN(x.value) && x.value > 0)) {
                specString += x.name + ':' + x.value.toString() + '#';
                return true;
            }
            else {
                if (!isNaN(x.value) && x.value <= 0) {
                    wx.showToast({
                        title: '专精等级必须大于0',
                        icon: 'none',
                        duration: 1000
                    });
                    checkValid = false;
                    return false;
                }
                else {
                    wx.showToast({
                        title: '请输入专精等级',
                        icon: 'none',
                        duration: 1000
                    });
                }
                checkValid = false;
                return false;
            }
        });
        if (!checkValid) {
            return;
        }
        specString = specString.substring(0, specString.length - 1);
        let detailData = {
            userId: this.data.userId,
            orderType: 1,
            orderServer: this.data.RealmType,
            orderCatalog: this.data.orderCatalog,
            orderCatalog1: this.data.orderCatalog1,
            orderCatalog2: this.data.orderCatalog2,
            orderCatalog3: this.data.orderCatalog3,
            orderMoney: this.data.money,
            characterId: this.data.characterId,
            characterSpec: specString,
            accountId: e.detail.value.accountName,
            accountPassword: e.detail.value.accountPassword,
            saveguard: this.data.hasGuard,
            phone: e.detail.value.phoneNumber,
            note: e.detail.value.note,
            remoteAddr: '12345'
        };
        if (detailData.accountId == "") {
            wx.showToast({
                title: '请输入账号',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        if (detailData.accountPassword == "") {
            wx.showToast({
                title: '请输入密码',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        if (detailData.phone == "") {
            wx.showToast({
                title: '请输入手机号码',
                icon: 'none',
                duration: 1000
            });
            return;
        }
        app.requestFunc('/order/saveOrder', detailData, 'POST', res => {
            console.log(res.data);
            if (res.data.success == true) {
                wx.showToast({
                    title: '下单完成',
                    icon: 'success',
                    duration: 1000
                });
                wx.navigateBack({
                    delta: 1
                });
            }
            else {
                wx.showToast({
                    title: res.data.msg,
                    icon: 'none',
                    duration: 1000
                });
            }
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JkZXJFbnRyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9yZGVyRW50cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sRUFBYyxDQUFBO0FBRWhDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLE1BQU0sRUFBRSxFQUFFO1FBQ1YsYUFBYSxFQUFFLFlBQVk7UUFDM0IsU0FBUyxFQUFFLENBQUM7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVUsRUFBRSxFQUFFO1FBQ2QsWUFBWSxFQUFFLEtBQUs7UUFDbkIsV0FBVyxFQUFFLEVBQUU7UUFDZixlQUFlLEVBQUUsRUFBRTtRQUNuQixXQUFXLEVBQUUsRUFBRTtRQUNmLFFBQVEsRUFBRSxDQUFDO1FBQ1gsWUFBWSxFQUFFLEVBQUU7UUFDaEIsYUFBYSxFQUFFLEVBQUU7UUFDakIsYUFBYSxFQUFFLEVBQUU7UUFDakIsYUFBYSxFQUFFLEVBQUU7UUFDakIsS0FBSyxFQUFFLENBQUM7UUFDUixlQUFlLEVBQUUsSUFBSSxLQUFLLEVBQWlDO0tBQzVEO0lBQ0QsTUFBTSxDQUFDLE9BQU87UUFDWixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFTLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsTUFBTSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO1lBQ25DLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtZQUNqQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO1lBQ2pDLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtZQUNqQyxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7WUFDakMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztTQUM5QixDQUFDLENB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QkFDWixRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUNILE9BQU87U0FDUjtRQUNELElBQUksVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQUU7WUFDMUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxLQUFLLEVBQUUsU0FBUztnQkFDaEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7WUFDSCxPQUFPO1NBQ1I7UUFFRCxHQUFHLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEIsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLEVBQUU7Z0JBQzVCLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1gsS0FBSyxFQUFFLE1BQU07b0JBQ2IsSUFBSSxFQUFFLFNBQVM7b0JBQ2YsUUFBUSxFQUFFLElBQUk7aUJBQ2YsQ0FBQyxDQUFBO2dCQUNGLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ2QsS0FBSyxFQUFFLENBQUM7aUJBQ1QsQ0FBQyxDQUFBO2FBQ0g7aUJBQU07Z0JBQ0wsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHO29CQUNuQixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUE7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIOiOt+WPluW6lOeUqOWunuS+i1xuY29uc3QgYXBwID0gZ2V0QXBwPElBcHBPcHRpb24+KClcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICB1c2VySWQ6ICcnLFxuICAgIGNoYXJhY3Rlck5hbWU6ICdxcXEvanpob291JyxcbiAgICBSZWFsbVR5cGU6IDEsXG4gICAgY2hhcmFjdGVySWQ6ICcnLFxuICAgIHNlcnZlck5hbWU6ICcnLFxuICAgIHNob3dQYXNzd29yZDogZmFsc2UsXG4gICAgYWNjb3VudE5hbWU6ICcnLFxuICAgIGFjY291bnRQYXNzd29yZDogJycsXG4gICAgcGhvbmVOdW1iZXI6ICcnLFxuICAgIGhhc0d1YXJkOiAxLFxuICAgIG9yZGVyQ2F0YWxvZzogJycsXG4gICAgb3JkZXJDYXRhbG9nMTogJycsXG4gICAgb3JkZXJDYXRhbG9nMjogJycsXG4gICAgb3JkZXJDYXRhbG9nMzogJycsXG4gICAgbW9uZXk6IDAsXG4gICAgc3BlY2lhbGl6YXRpb25zOiBuZXcgQXJyYXk8e25hbWU6IHN0cmluZywgdmFsdWU6IG51bWJlcn0+KCksXG4gIH0sXG4gIG9uTG9hZChvcHRpb25zKSB7XG4gICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoPHN0cmluZz5vcHRpb25zLmRhdGEpO1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICB1c2VySWQ6IHd4LmdldFN0b3JhZ2VTeW5jKCd1c2VySWQnKSxcbiAgICAgIGNoYXJhY3Rlck5hbWU6IGRhdGEuY2hhcmFjdGVyTmFtZSxcbiAgICAgIG9yZGVyQ2F0YWxvZzogZGF0YS5vcmRlckNhdGFsb2csXG4gICAgICBvcmRlckNhdGFsb2cxOiBkYXRhLm9yZGVyQ2F0YWxvZzEsXG4gICAgICBvcmRlckNhdGFsb2cyOiBkYXRhLm9yZGVyQ2F0YWxvZzIsXG4gICAgICBvcmRlckNhdGFsb2czOiBkYXRhLm9yZGVyQ2F0YWxvZzMsXG4gICAgICBtb25leTogZGF0YS5tb25leSxcbiAgICAgIGNoYXJhY3RlcklkOiBkYXRhLmNoYXJhY3RlcklkXG4gICAgfSkgXG4gIH0sXG4gIG9uU2hvdygpIHtcbiAgICBjb25zdCBfdGhpcyA9IHRoaXNcbiAgICBhcHAucmVxdWVzdEZ1bmNQcm9taXNlKCcvdXNlci9nZXRDaGFyYWN0ZXInLCB7Y2hhcmFjdGVySWQ6IHRoaXMuZGF0YS5jaGFyYWN0ZXJJZH0sICdHRVQnKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICBpZihyZXMuZGF0YS5kYXRhLmNoYXJhY3RlclJlYWxtVHlwZSA9PSAxKSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgUmVhbG1UeXBlOiByZXMuZGF0YS5kYXRhLmNoYXJhY3RlclJlYWxtVHlwZSxcbiAgICAgICAgICBzZXJ2ZXJOYW1lOiAn5q2j5byP5pyNJ1xuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgaWYocmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJSZWFsbVR5cGUgPT0gMikge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIFJlYWxtVHlwZTogcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJSZWFsbVR5cGUsXG4gICAgICAgICAgc2VydmVyTmFtZTogJ+aAgOaXp+acjSdcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyU3BlY2lhbGl6YXRpb24uc3BsaXQoJyMnKS5mb3JFYWNoKHggPT4ge1xuICAgICAgICBsZXQgdGVtcCA9IHguc3BsaXQoJzonKTtcbiAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgc3BlY2lhbGl6YXRpb25zIDogX3RoaXMuZGF0YS5zcGVjaWFsaXphdGlvbnNcbiAgICAgICAgfTtcbiAgICAgICAgaWYocGFyc2VJbnQodGVtcFsxXSkgPiAwKSB7XG4gICAgICAgICAgZGF0YS5zcGVjaWFsaXphdGlvbnMucHVzaCh7bmFtZTogdGVtcFswXSwgdmFsdWU6IHBhcnNlSW50KHRlbXBbMV0pfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xuICAgICAgfSk7XG4gICAgfSlcbiAgICAuY2F0Y2gocmVzID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgfSlcbiAgfSxcblxuICBpbnB1dEFjY291bnROYW1lKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgYWNjb3VudE5hbWU6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgU2hvd1Bhc3N3b3JkKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzaG93UGFzc3dvcmQ6ICF0aGlzLmRhdGEuc2hvd1Bhc3N3b3JkXG4gICAgfSlcbiAgfSxcbiAgaW5wdXRQYXNzd29yZChlKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGFjY291bnRQYXNzd29yZDogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuXG4gIGlucHV0UGhvbmVOdW1iZXIoZSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBwaG9uZU51bWJlcjogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuXG4gIGNoYW5nZUd1YXJkKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgaGFzR3VhcmQ6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuXG4gIGZvcm1TdWJtaXQoZSkge1xuICAgIGNvbnN0IF90aGlzID0gdGhpcztcbiAgICBsZXQgc3BlY1N0cmluZyA9ICcnO1xuICAgIGxldCBjaGVja1ZhbGlkID0gdHJ1ZTtcbiAgICB0aGlzLmRhdGEuc3BlY2lhbGl6YXRpb25zLmV2ZXJ5KHggPT4ge1xuICAgICAgaWYgKCghaXNOYU4oeC52YWx1ZSkgJiYgeC52YWx1ZSA+IDApKSB7XG4gICAgICAgIHNwZWNTdHJpbmcgKz0geC5uYW1lICsgJzonICsgeC52YWx1ZS50b1N0cmluZygpICsgJyMnXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFpc05hTih4LnZhbHVlKSAmJiB4LnZhbHVlIDw9IDApIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfkuJPnsr7nrYnnuqflv4XpobvlpKfkuo4wJyxcbiAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2hlY2tWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfor7fovpPlhaXkuJPnsr7nrYnnuqcnLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjaGVja1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZighY2hlY2tWYWxpZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzcGVjU3RyaW5nID0gc3BlY1N0cmluZy5zdWJzdHJpbmcoMCwgc3BlY1N0cmluZy5sZW5ndGggLSAxKTtcblxuICAgIGxldCBkZXRhaWxEYXRhID0ge1xuICAgICAgdXNlcklkOiB0aGlzLmRhdGEudXNlcklkLFxuICAgICAgb3JkZXJUeXBlOiAxLFxuICAgICAgb3JkZXJTZXJ2ZXI6IHRoaXMuZGF0YS5SZWFsbVR5cGUsXG4gICAgICBvcmRlckNhdGFsb2c6IHRoaXMuZGF0YS5vcmRlckNhdGFsb2csXG4gICAgICBvcmRlckNhdGFsb2cxOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nMSxcbiAgICAgIG9yZGVyQ2F0YWxvZzI6IHRoaXMuZGF0YS5vcmRlckNhdGFsb2cyLFxuICAgICAgb3JkZXJDYXRhbG9nMzogdGhpcy5kYXRhLm9yZGVyQ2F0YWxvZzMsXG4gICAgICBvcmRlck1vbmV5OiB0aGlzLmRhdGEubW9uZXksXG4gICAgICBjaGFyYWN0ZXJJZDogdGhpcy5kYXRhLmNoYXJhY3RlcklkLFxuICAgICAgY2hhcmFjdGVyU3BlYzogc3BlY1N0cmluZyxcbiAgICAgIGFjY291bnRJZDogZS5kZXRhaWwudmFsdWUuYWNjb3VudE5hbWUsXG4gICAgICBhY2NvdW50UGFzc3dvcmQ6IGUuZGV0YWlsLnZhbHVlLmFjY291bnRQYXNzd29yZCxcbiAgICAgIHNhdmVndWFyZDogdGhpcy5kYXRhLmhhc0d1YXJkLFxuICAgICAgcGhvbmU6IGUuZGV0YWlsLnZhbHVlLnBob25lTnVtYmVyLFxuICAgICAgbm90ZTogZS5kZXRhaWwudmFsdWUubm90ZSxcbiAgICAgIHJlbW90ZUFkZHI6ICcxMjM0NSdcbiAgICB9XG5cbiAgICBpZiAoZGV0YWlsRGF0YS5hY2NvdW50SWQgPT0gXCJcIikge1xuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6ICfor7fovpPlhaXotKblj7cnLFxuICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGRldGFpbERhdGEuYWNjb3VudFBhc3N3b3JkID09IFwiXCIpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+36L6T5YWl5a+G56CBJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChkZXRhaWxEYXRhLnBob25lID09IFwiXCIpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+36L6T5YWl5omL5py65Y+356CBJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIGFwcC5yZXF1ZXN0RnVuYygnL29yZGVyL3NhdmVPcmRlcicsIGRldGFpbERhdGEsICdQT1NUJywgcmVzID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKTtcbiAgICAgIGlmIChyZXMuZGF0YS5zdWNjZXNzID09IHRydWUpIHtcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogJ+S4i+WNleWujOaIkCcsXG4gICAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgIH0pXG4gICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgZGVsdGE6IDFcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6IHJlcy5kYXRhLm1zZyxcbiAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9LFxufSlcbiJdfQ==