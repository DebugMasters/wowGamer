"use strict";
const app = getApp();
Page({
    data: {
        mode: '',
        userId: '',
        orderId: '',
        characterName: '',
        RealmType: 1,
        characterId: '',
        serverName: '',
        showPassword: false,
        accountName: '',
        accountPassword: '',
        phoneNumber: '',
        hasGuard: 1,
        orderCatalog: '',
        orderCatalog1: '',
        orderCatalog2: '',
        orderCatalog3: '',
        money: 0,
        originMoney: 0,
        specializations: new Array(),
        note: '',
        orderStatus: 9,
        coupons: new Array(),
        couponIndex: 0
    },
    onLoad(options) {
        const data = JSON.parse(options.data);
        if (data.mode == 'AddNew') {
            this.setData({
                mode: data.mode,
                userId: wx.getStorageSync('userId'),
                orderCatalog: data.orderCatalog,
                orderCatalog1: data.orderCatalog1,
                orderCatalog2: data.orderCatalog2,
                orderCatalog3: data.orderCatalog3,
                money: data.money,
                originMoney: data.money,
                characterId: data.characterId
            });
        }
        if (data.mode == 'Detail') {
            this.setData({
                mode: data.mode,
                userId: data.userId,
                orderId: data.orderId
            });
        }
    },
    onShow() {
        if (this.data.mode == 'AddNew') {
            app.requestFuncPromise('/user/getCharacter', { characterId: this.data.characterId }, 'GET')
                .then(res => {
                if (parseInt(res.data.data.realmType) == 1) {
                    this.setData({
                        RealmType: parseInt(res.data.data.realmType),
                        characterName: res.data.data.characterName + '/' + res.data.data.accountName,
                        serverName: '正式服/' + res.data.data.realmZoneName + '/' + res.data.data.realmName
                    });
                }
                if (parseInt(res.data.data.realmType) == 2) {
                    this.setData({
                        RealmType: parseInt(res.data.data.realmType),
                        characterName: res.data.data.characterName + '/' + res.data.data.accountName,
                        serverName: '怀旧服/' + res.data.data.realmZoneName + '/' + res.data.data.realmName
                    });
                }
                res.data.data.characterSpecialization.split('#').forEach(x => {
                    let temp = x.split(':');
                    let data = {
                        specializations: new Array(),
                    };
                    if (parseInt(temp[1]) > 0) {
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                    }
                    this.setData(data);
                });
            });
            this.getAvailableCoupon();
        }
        if (this.data.mode == 'Detail') {
            app.requestFuncPromise('/order/orderDetail', { userId: this.data.userId, orderId: this.data.orderId }, 'GET')
                .then((res) => {
                this.setData({
                    characterId: res.data.data.characterId,
                    characterName: res.data.data.characterInfo,
                    serverName: res.data.data.characterRealm,
                    accountName: res.data.data.accountId,
                    accountPassword: res.data.data.accountPassword,
                    orderCatalog: res.data.data.orderCatalog,
                    phoneNumber: res.data.data.phone,
                    money: res.data.data.orderMoney,
                    originMoney: res.data.data.orderMoney,
                    hasGuard: res.data.data.saveguard,
                    note: res.data.data.note,
                    orderStatus: res.data.data.orderStatus
                }),
                    res.data.data.characterSpec.split('#').forEach(x => {
                        let temp = x.split(':');
                        let data = {
                            specializations: new Array(),
                        };
                        data.specializations.push({ name: temp[0], value: parseInt(temp[1]) });
                        this.setData(data);
                    });
            });
        }
    },
    inputNote(e) {
        this.setData({
            note: e.detail.value
        });
    },
    inputAccountName(e) {
        this.setData({
            accountName: e.detail.value
        });
    },
    ShowPassword() {
        this.setData({
            showPassword: !this.data.showPassword
        });
    },
    inputPassword(e) {
        this.setData({
            accountPassword: e.detail.value
        });
    },
    inputPhoneNumber(e) {
        this.setData({
            phoneNumber: e.detail.value
        });
    },
    changeGuard(e) {
        this.setData({
            hasGuard: e.detail.value
        });
    },
    getAvailableCoupon() {
        app.requestFuncPromise('/order/availableCoupon', { userId: this.data.userId }, 'GET')
            .then((res) => {
            if (res.data.success) {
                let data = {
                    coupons: new Array()
                };
                data.coupons.push({ id: 'null', status: 1, name: '不使用优惠券', discount: 0, expireTime: new Date() });
                res.data.couponList.forEach(x => {
                    if (x.status == 1) {
                        data.coupons.push({ id: x.couponId, status: x.couponStatus, name: x.couponName, discount: x.couponDiscount, expireTime: x.expireTime });
                    }
                });
                this.setData(data);
                this.calcMoney();
            }
        });
    },
    couponChange(e) {
        this.setData({
            couponIndex: e.detail.value
        });
        this.calcMoney();
    },
    calcMoney() {
        if (this.data.coupons[this.data.couponIndex].id != 'null') {
            let data = {
                money: this.data.money,
                originMoney: this.data.money
            };
            data.money = this.data.money * this.data.coupons[this.data.couponIndex].discount;
            this.setData(data);
        }
        else {
            let data = {
                money: this.data.originMoney,
                originMoney: this.data.originMoney
            };
            this.setData(data);
        }
    },
    formSubmit(e) {
        const _this = this;
        let specString = '';
        let checkValid = true;
        this.data.specializations.every(x => {
            if ((!isNaN(x.value) && x.value > 0)) {
                specString += x.name + ':' + x.value.toString() + '#';
                return true;
            }
            else {
                if (!isNaN(x.value) && x.value <= 0) {
                    wx.showToast({
                        title: '专精等级必须大于0',
                        icon: 'none',
                        duration: 1000
                    });
                    checkValid = false;
                    return false;
                }
                else {
                    wx.showToast({
                        title: '请输入专精等级',
                        icon: 'none',
                        duration: 1000
                    });
                }
                checkValid = false;
                return false;
            }
        });
        if (!checkValid) {
            return;
        }
        specString = specString.substring(0, specString.length - 1);
        let detailData = {
            orderId: this.data.orderId != '' ? this.data.orderId : '',
            userId: this.data.userId,
            orderType: 1,
            orderServer: this.data.RealmType,
            orderCatalog: this.data.orderCatalog,
            orderCatalog1: this.data.orderCatalog1,
            orderCatalog2: this.data.orderCatalog2,
            orderCatalog3: this.data.orderCatalog3,
            orderMoney: this.data.money,
            characterId: this.data.characterId,
            characterInfo: this.data.characterName,
            characterRealm: this.data.serverName,
            characterSpec: specString,
            accountId: e.detail.value.accountName,
            accountPassword: e.detail.value.accountPassword,
            saveguard: this.data.hasGuard,
            phone: e.detail.value.phoneNumber,
            note: e.detail.value.note,
            remoteAddr: '',
            couponId: ''
        };
        if (this.data.orderStatus == 9) {
            detailData.couponId = this.data.coupons[this.data.couponIndex].id != 'null' ? this.data.coupons[this.data.couponIndex].id : '';
        }
        if (detailData.accountId == "") {
            wx.showToast({
                title: '请输入账号',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        if (detailData.accountPassword == "") {
            wx.showToast({
                title: '请输入密码',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        if (detailData.phone == "") {
            wx.showToast({
                title: '请输入手机号码',
                icon: 'none',
                mask: true,
                duration: 1000
            });
            return;
        }
        wx.request({
            url: 'https://pv.sohu.com/cityjson?ie=utf-8',
            success: function (e) {
                console.log(e.data);
                const ipAddress = e.data.split(' ')[4].replace('"', '').replace('"', '').replace(',', '');
                detailData.remoteAddr = ipAddress;
                app.requestFunc('/order/saveOrder', detailData, 'POST', res => {
                    console.log(res.data);
                    if (res.data.success == true) {
                        if (res.data.payInfo) {
                            wx.requestPayment({
                                'timeStamp': res.data.payInfo.timeStamp.toString(),
                                'nonceStr': res.data.payInfo.nonceStr,
                                'package': res.data.payInfo.package,
                                'signType': res.data.payInfo.signType,
                                'paySign': res.data.payInfo.sign,
                                success: function (res) {
                                    console.log(res);
                                    wx.showToast({
                                        title: '支付成功',
                                        icon: 'none',
                                        duration: 1500
                                    });
                                    wx.navigateBack({
                                        delta: 1
                                    });
                                },
                                fail: function (res) {
                                    console.log(res);
                                    wx.showToast({
                                        title: '支付失败',
                                        icon: 'none',
                                        duration: 1500
                                    });
                                    _this.setData({
                                        mode: 'Detail'
                                    });
                                    _this.onShow();
                                }
                            });
                        }
                        else {
                            wx.showToast({
                                title: res.data.msg,
                                icon: 'none',
                                duration: 1000
                            });
                        }
                    }
                    else {
                        wx.showToast({
                            title: res.data.msg,
                            icon: 'none',
                            duration: 1000
                        });
                    }
                });
            }
        });
    },
    cancelOrder() {
        const _this = this;
        let detailData = {
            orderId: this.data.orderId,
            userId: this.data.userId
        };
        app.requestFunc('/order/cancelOrder', detailData, 'POST', res => {
            console.log(res.data);
            if (res.data.success == true) {
                wx.showToast({
                    title: '取消订单成功',
                    icon: 'none',
                    duration: 1500
                });
                wx.navigateBack({
                    delta: 1
                });
                _this.onShow();
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JkZXJFbnRyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9yZGVyRW50cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sRUFBYyxDQUFBO0FBRWhDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLElBQUksRUFBRSxFQUFFO1FBQ1IsTUFBTSxFQUFFLEVBQUU7UUFDVixPQUFPLEVBQUUsRUFBRTtRQUNYLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLFNBQVMsRUFBRSxDQUFDO1FBQ1osV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVLEVBQUUsRUFBRTtRQUNkLFlBQVksRUFBRSxLQUFLO1FBQ25CLFdBQVcsRUFBRSxFQUFFO1FBQ2YsZUFBZSxFQUFFLEVBQUU7UUFDbkIsV0FBVyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsQ0FBQztRQUNYLFlBQVksRUFBRSxFQUFFO1FBQ2hCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLEtBQUssRUFBRSxDQUFDO1FBQ1IsV0FBVyxFQUFFLENBQUM7UUFDZCxlQUFlLEVBQUUsSUFBSSxLQUFLLEVBQWlDO1FBQzNELElBQUksRUFBRSxFQUFFO1FBQ1IsV0FBVyxFQUFFLENBQUM7UUFDZCxPQUFPLEVBQUUsSUFBSSxLQUFLLEVBQWtGO1FBQ3BHLFdBQVcsRUFBRSxDQUFDO0tBQ2Y7SUFDRCxNQUFNLENBQUMsT0FBTztRQUNaLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQVMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLElBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxRQUFRLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO2dCQUNuQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7Z0JBQy9CLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtnQkFDakMsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO2dCQUNqQyxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7Z0JBQ2pDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLO2dCQUN2QixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7YUFDOUIsQ0FBQyxDQUFBO1NBQ0g7UUFDRCxJQUFHLElBQUksQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtnQkFDbkIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2FBQ3RCLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztJQUNELE1BQU07UUFDSixJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRTtZQUM3QixHQUFHLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLEVBQUUsRUFBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUMsRUFBRSxLQUFLLENBQUM7aUJBQ3hGLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDVixJQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUM7d0JBQ1gsU0FBUyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7d0JBQzVDLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7d0JBQzVFLFVBQVUsRUFBRSxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTO3FCQUNqRixDQUFDLENBQUE7aUJBQ0g7Z0JBQ0QsSUFBRyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDO3dCQUNYLFNBQVMsRUFBRSxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO3dCQUM1QyxhQUFhLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXO3dCQUM1RSxVQUFVLEVBQUUsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUztxQkFDakYsQ0FBQyxDQUFBO2lCQUNIO2dCQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQzNELElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3hCLElBQUksSUFBSSxHQUFHO3dCQUNULGVBQWUsRUFBRyxJQUFJLEtBQUssRUFBaUM7cUJBQzdELENBQUM7b0JBQ0YsSUFBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFO3dCQUN4QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7cUJBQ3RFO29CQUNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3JCLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUE7WUFDRixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztTQUMzQjtRQUNELElBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQzdCLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUMsRUFBRSxLQUFLLENBQUM7aUJBQzFHLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUNaLElBQUksQ0FBQyxPQUFPLENBQUM7b0JBQ1gsV0FBVyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7b0JBQ3RDLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhO29CQUMxQyxVQUFVLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYztvQkFDeEMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7b0JBQ3BDLGVBQWUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlO29CQUM5QyxZQUFZLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWTtvQkFDeEMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7b0JBQ2hDLEtBQUssRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVO29CQUMvQixXQUFXLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVTtvQkFDckMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7b0JBQ2pDLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUN4QixXQUFXLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVztpQkFDdkMsQ0FBQztvQkFDRixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDakQsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFDeEIsSUFBSSxJQUFJLEdBQUc7NEJBQ1QsZUFBZSxFQUFHLElBQUksS0FBSyxFQUFpQzt5QkFDN0QsQ0FBQzt3QkFDRixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7d0JBQ3JFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3JCLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFDRCxTQUFTLENBQUMsQ0FBTTtRQUNkLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1NBQ3JCLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFDRCxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1NBQzVCLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFDRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWTtTQUN0QyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsYUFBYSxDQUFDLENBQUM7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsZUFBZSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSztTQUNoQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsZ0JBQWdCLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsV0FBVyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSztTQUM1QixDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsV0FBVyxDQUFDLENBQUM7UUFDWCxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsUUFBUSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSztTQUN6QixDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0Qsa0JBQWtCO1FBQ2hCLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyx3QkFBd0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBQyxFQUFFLEtBQUssQ0FBQzthQUNsRixJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNaLElBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ25CLElBQUksSUFBSSxHQUFHO29CQUNULE9BQU8sRUFBRSxJQUFJLEtBQUssRUFBa0Y7aUJBQ3JHLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFDLENBQUMsQ0FBQTtnQkFDL0YsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUM5QixJQUFHLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO3dCQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsY0FBYyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFDLENBQUMsQ0FBQTtxQkFDdEk7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbkIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2FBQ2xCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0QsWUFBWSxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsV0FBVyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSztTQUM1QixDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkIsQ0FBQztJQUNELFNBQVM7UUFDUCxJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxJQUFJLE1BQU0sRUFBRTtZQUN4RCxJQUFJLElBQUksR0FBRztnQkFDVCxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO2dCQUN0QixXQUFXLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO2FBQzdCLENBQUE7WUFDRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFBO1lBQ2hGLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUE7U0FDbkI7YUFBTTtZQUNMLElBQUksSUFBSSxHQUFHO2dCQUNULEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7Z0JBQzVCLFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7YUFDbkMsQ0FBQTtZQUNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLENBQUM7UUFDVixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDbEMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUNwQyxVQUFVLElBQUksQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsR0FBRyxHQUFHLENBQUE7Z0JBQ3JELE9BQU8sSUFBSSxDQUFDO2FBQ2I7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQUU7b0JBQ25DLEVBQUUsQ0FBQyxTQUFTLENBQUM7d0JBQ1gsS0FBSyxFQUFFLFdBQVc7d0JBQ2xCLElBQUksRUFBRSxNQUFNO3dCQUNaLFFBQVEsRUFBRSxJQUFJO3FCQUNmLENBQUMsQ0FBQztvQkFDSCxVQUFVLEdBQUcsS0FBSyxDQUFDO29CQUNuQixPQUFPLEtBQUssQ0FBQztpQkFDZDtxQkFBTTtvQkFDTCxFQUFFLENBQUMsU0FBUyxDQUFDO3dCQUNYLEtBQUssRUFBRSxTQUFTO3dCQUNoQixJQUFJLEVBQUUsTUFBTTt3QkFDWixRQUFRLEVBQUUsSUFBSTtxQkFDZixDQUFDLENBQUM7aUJBQ0o7Z0JBQ0QsVUFBVSxHQUFHLEtBQUssQ0FBQztnQkFDbkIsT0FBTyxLQUFLLENBQUM7YUFDZDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBRyxDQUFDLFVBQVUsRUFBRTtZQUNkLE9BQU87U0FDUjtRQUNELFVBQVUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRTVELElBQUksVUFBVSxHQUFHO1lBQ2YsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUEsQ0FBQyxDQUFDLEVBQUU7WUFDeEQsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTtZQUN4QixTQUFTLEVBQUUsQ0FBQztZQUNaLFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7WUFDaEMsWUFBWSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWTtZQUNwQyxhQUFhLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhO1lBQ3RDLGFBQWEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWE7WUFDdEMsYUFBYSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYTtZQUN0QyxVQUFVLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO1lBQzNCLFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7WUFDbEMsYUFBYSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYTtZQUN0QyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVO1lBQ3BDLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLFNBQVMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXO1lBQ3JDLGVBQWUsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlO1lBQy9DLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFDN0IsS0FBSyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVc7WUFDakMsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUk7WUFDekIsVUFBVSxFQUFFLEVBQUU7WUFDZCxRQUFRLEVBQUUsRUFBRTtTQUNiLENBQUE7UUFHRCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsRUFBRTtZQUM5QixVQUFVLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtTQUMvSDtRQUNELElBQUksVUFBVSxDQUFDLFNBQVMsSUFBSSxFQUFFLEVBQUU7WUFDOUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxLQUFLLEVBQUUsT0FBTztnQkFDZCxJQUFJLEVBQUUsTUFBTTtnQkFDWixJQUFJLEVBQUUsSUFBSTtnQkFDVixRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUNILE9BQU87U0FDUjtRQUNELElBQUksVUFBVSxDQUFDLGVBQWUsSUFBSSxFQUFFLEVBQUU7WUFDcEMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxLQUFLLEVBQUUsT0FBTztnQkFDZCxJQUFJLEVBQUUsTUFBTTtnQkFDWixJQUFJLEVBQUUsSUFBSTtnQkFDVixRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUNILE9BQU87U0FDUjtRQUNELElBQUksVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQUU7WUFDMUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxLQUFLLEVBQUUsU0FBUztnQkFDaEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osSUFBSSxFQUFFLElBQUk7Z0JBQ1YsUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7WUFDSCxPQUFPO1NBQ1I7UUFFRCxFQUFFLENBQUMsT0FBTyxDQUFDO1lBQ1QsR0FBRyxFQUFFLHVDQUF1QztZQUM1QyxPQUFPLEVBQUUsVUFBVSxDQUFDO2dCQUNsQixPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDcEIsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUE7Z0JBQ3hGLFVBQVUsQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFBO2dCQUVqQyxHQUFHLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUU7b0JBQzVELE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUN0QixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksRUFBRTt3QkFDNUIsSUFBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTs0QkFDbkIsRUFBRSxDQUFDLGNBQWMsQ0FBQztnQ0FDaEIsV0FBVyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUU7Z0NBQ2xELFVBQVUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRO2dDQUNyQyxTQUFTLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTztnQ0FDbkMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVE7Z0NBQ3JDLFNBQVMsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJO2dDQUNoQyxPQUFPLEVBQUUsVUFBVSxHQUFHO29DQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUNqQixFQUFFLENBQUMsU0FBUyxDQUFDO3dDQUNYLEtBQUssRUFBRSxNQUFNO3dDQUNiLElBQUksRUFBRSxNQUFNO3dDQUNaLFFBQVEsRUFBRSxJQUFJO3FDQUNmLENBQUMsQ0FBQztvQ0FDSCxFQUFFLENBQUMsWUFBWSxDQUFDO3dDQUNkLEtBQUssRUFBRSxDQUFDO3FDQUNULENBQUMsQ0FBQTtnQ0FDSixDQUFDO2dDQUNELElBQUksRUFBRSxVQUFVLEdBQUc7b0NBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0NBQ2pCLEVBQUUsQ0FBQyxTQUFTLENBQUM7d0NBQ1gsS0FBSyxFQUFFLE1BQU07d0NBQ2IsSUFBSSxFQUFFLE1BQU07d0NBQ1osUUFBUSxFQUFFLElBQUk7cUNBQ2YsQ0FBQyxDQUFDO29DQUNILEtBQUssQ0FBQyxPQUFPLENBQUM7d0NBQ1osSUFBSSxFQUFFLFFBQVE7cUNBQ2YsQ0FBQyxDQUFBO29DQUNGLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQ0FDakIsQ0FBQzs2QkFDRixDQUFDLENBQUM7eUJBQ0o7NkJBQU07NEJBQ0wsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQ0FDWCxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHO2dDQUNuQixJQUFJLEVBQUUsTUFBTTtnQ0FDWixRQUFRLEVBQUUsSUFBSTs2QkFDZixDQUFDLENBQUE7eUJBQ0g7cUJBQ0Y7eUJBQU07d0JBQ0wsRUFBRSxDQUFDLFNBQVMsQ0FBQzs0QkFDWCxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHOzRCQUNuQixJQUFJLEVBQUUsTUFBTTs0QkFDWixRQUFRLEVBQUUsSUFBSTt5QkFDZixDQUFDLENBQUE7cUJBQ0g7Z0JBQ0gsQ0FBQyxDQUFDLENBQUE7WUFDSixDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFdBQVc7UUFDVCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxVQUFVLEdBQUc7WUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQzFCLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07U0FDekIsQ0FBQTtRQUNELEdBQUcsQ0FBQyxXQUFXLENBQUMsb0JBQW9CLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRTtZQUM5RCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksRUFBRTtnQkFDNUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsUUFBUTtvQkFDZixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUM7Z0JBQ0gsRUFBRSxDQUFDLFlBQVksQ0FBQztvQkFDZCxLQUFLLEVBQUUsQ0FBQztpQkFDVCxDQUFDLENBQUE7Z0JBQ0YsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ2hCO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8g6I635Y+W5bqU55So5a6e5L6LXG5jb25zdCBhcHAgPSBnZXRBcHA8SUFwcE9wdGlvbj4oKVxuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIG1vZGU6ICcnLFxuICAgIHVzZXJJZDogJycsXG4gICAgb3JkZXJJZDogJycsXG4gICAgY2hhcmFjdGVyTmFtZTogJycsXG4gICAgUmVhbG1UeXBlOiAxLFxuICAgIGNoYXJhY3RlcklkOiAnJyxcbiAgICBzZXJ2ZXJOYW1lOiAnJyxcbiAgICBzaG93UGFzc3dvcmQ6IGZhbHNlLFxuICAgIGFjY291bnROYW1lOiAnJyxcbiAgICBhY2NvdW50UGFzc3dvcmQ6ICcnLFxuICAgIHBob25lTnVtYmVyOiAnJyxcbiAgICBoYXNHdWFyZDogMSxcbiAgICBvcmRlckNhdGFsb2c6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzE6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzI6ICcnLFxuICAgIG9yZGVyQ2F0YWxvZzM6ICcnLFxuICAgIG1vbmV5OiAwLFxuICAgIG9yaWdpbk1vbmV5OiAwLFxuICAgIHNwZWNpYWxpemF0aW9uczogbmV3IEFycmF5PHtuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXJ9PigpLFxuICAgIG5vdGU6ICcnLFxuICAgIG9yZGVyU3RhdHVzOiA5LFxuICAgIGNvdXBvbnM6IG5ldyBBcnJheTx7aWQ6IHN0cmluZywgc3RhdHVzOiBudW1iZXIsIG5hbWU6IHN0cmluZywgZGlzY291bnQ6IG51bWJlciwgZXhwaXJlVGltZTogRGF0ZX0+KCksXG4gICAgY291cG9uSW5kZXg6IDBcbiAgfSxcbiAgb25Mb2FkKG9wdGlvbnMpIHtcbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZSg8c3RyaW5nPm9wdGlvbnMuZGF0YSk7XG4gICAgaWYoZGF0YS5tb2RlID09ICdBZGROZXcnKSB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBtb2RlOiBkYXRhLm1vZGUsXG4gICAgICAgIHVzZXJJZDogd3guZ2V0U3RvcmFnZVN5bmMoJ3VzZXJJZCcpLFxuICAgICAgICBvcmRlckNhdGFsb2c6IGRhdGEub3JkZXJDYXRhbG9nLFxuICAgICAgICBvcmRlckNhdGFsb2cxOiBkYXRhLm9yZGVyQ2F0YWxvZzEsXG4gICAgICAgIG9yZGVyQ2F0YWxvZzI6IGRhdGEub3JkZXJDYXRhbG9nMixcbiAgICAgICAgb3JkZXJDYXRhbG9nMzogZGF0YS5vcmRlckNhdGFsb2czLFxuICAgICAgICBtb25leTogZGF0YS5tb25leSxcbiAgICAgICAgb3JpZ2luTW9uZXk6IGRhdGEubW9uZXksXG4gICAgICAgIGNoYXJhY3RlcklkOiBkYXRhLmNoYXJhY3RlcklkXG4gICAgICB9KSBcbiAgICB9XG4gICAgaWYoZGF0YS5tb2RlID09ICdEZXRhaWwnKSB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBtb2RlOiBkYXRhLm1vZGUsXG4gICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgIG9yZGVySWQ6IGRhdGEub3JkZXJJZFxuICAgICAgfSkgXG4gICAgfVxuICB9LFxuICBvblNob3coKSB7XG4gICAgaWYodGhpcy5kYXRhLm1vZGUgPT0gJ0FkZE5ldycpIHtcbiAgICAgIGFwcC5yZXF1ZXN0RnVuY1Byb21pc2UoJy91c2VyL2dldENoYXJhY3RlcicsIHtjaGFyYWN0ZXJJZDogdGhpcy5kYXRhLmNoYXJhY3RlcklkfSwgJ0dFVCcpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBpZihwYXJzZUludChyZXMuZGF0YS5kYXRhLnJlYWxtVHlwZSkgPT0gMSkge1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBSZWFsbVR5cGU6IHBhcnNlSW50KHJlcy5kYXRhLmRhdGEucmVhbG1UeXBlKSxcbiAgICAgICAgICAgIGNoYXJhY3Rlck5hbWU6IHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyTmFtZSArICcvJyArIHJlcy5kYXRhLmRhdGEuYWNjb3VudE5hbWUsXG4gICAgICAgICAgICBzZXJ2ZXJOYW1lOiAn5q2j5byP5pyNLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtWm9uZU5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLnJlYWxtTmFtZVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYocGFyc2VJbnQocmVzLmRhdGEuZGF0YS5yZWFsbVR5cGUpID09IDIpIHtcbiAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgUmVhbG1UeXBlOiBwYXJzZUludChyZXMuZGF0YS5kYXRhLnJlYWxtVHlwZSksXG4gICAgICAgICAgICBjaGFyYWN0ZXJOYW1lOiByZXMuZGF0YS5kYXRhLmNoYXJhY3Rlck5hbWUgKyAnLycgKyByZXMuZGF0YS5kYXRhLmFjY291bnROYW1lLFxuICAgICAgICAgICAgc2VydmVyTmFtZTogJ+aAgOaXp+acjS8nICsgcmVzLmRhdGEuZGF0YS5yZWFsbVpvbmVOYW1lICsgJy8nICsgcmVzLmRhdGEuZGF0YS5yZWFsbU5hbWVcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIHJlcy5kYXRhLmRhdGEuY2hhcmFjdGVyU3BlY2lhbGl6YXRpb24uc3BsaXQoJyMnKS5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgIGxldCB0ZW1wID0geC5zcGxpdCgnOicpO1xuICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgc3BlY2lhbGl6YXRpb25zIDogbmV3IEFycmF5PHtuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXJ9PigpLFxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYocGFyc2VJbnQodGVtcFsxXSkgPiAwKSB7XG4gICAgICAgICAgICBkYXRhLnNwZWNpYWxpemF0aW9ucy5wdXNoKHtuYW1lOiB0ZW1wWzBdLCB2YWx1ZTogcGFyc2VJbnQodGVtcFsxXSl9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICB0aGlzLmdldEF2YWlsYWJsZUNvdXBvbigpO1xuICAgIH1cbiAgICBpZih0aGlzLmRhdGEubW9kZSA9PSAnRGV0YWlsJykge1xuICAgICAgYXBwLnJlcXVlc3RGdW5jUHJvbWlzZSgnL29yZGVyL29yZGVyRGV0YWlsJywge3VzZXJJZDogdGhpcy5kYXRhLnVzZXJJZCwgb3JkZXJJZDogdGhpcy5kYXRhLm9yZGVySWR9LCAnR0VUJylcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBjaGFyYWN0ZXJJZDogcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJJZCxcbiAgICAgICAgICBjaGFyYWN0ZXJOYW1lOiByZXMuZGF0YS5kYXRhLmNoYXJhY3RlckluZm8sXG4gICAgICAgICAgc2VydmVyTmFtZTogcmVzLmRhdGEuZGF0YS5jaGFyYWN0ZXJSZWFsbSxcbiAgICAgICAgICBhY2NvdW50TmFtZTogcmVzLmRhdGEuZGF0YS5hY2NvdW50SWQsXG4gICAgICAgICAgYWNjb3VudFBhc3N3b3JkOiByZXMuZGF0YS5kYXRhLmFjY291bnRQYXNzd29yZCxcbiAgICAgICAgICBvcmRlckNhdGFsb2c6IHJlcy5kYXRhLmRhdGEub3JkZXJDYXRhbG9nLFxuICAgICAgICAgIHBob25lTnVtYmVyOiByZXMuZGF0YS5kYXRhLnBob25lLFxuICAgICAgICAgIG1vbmV5OiByZXMuZGF0YS5kYXRhLm9yZGVyTW9uZXksXG4gICAgICAgICAgb3JpZ2luTW9uZXk6IHJlcy5kYXRhLmRhdGEub3JkZXJNb25leSxcbiAgICAgICAgICBoYXNHdWFyZDogcmVzLmRhdGEuZGF0YS5zYXZlZ3VhcmQsXG4gICAgICAgICAgbm90ZTogcmVzLmRhdGEuZGF0YS5ub3RlLFxuICAgICAgICAgIG9yZGVyU3RhdHVzOiByZXMuZGF0YS5kYXRhLm9yZGVyU3RhdHVzXG4gICAgICAgIH0pLFxuICAgICAgICByZXMuZGF0YS5kYXRhLmNoYXJhY3RlclNwZWMuc3BsaXQoJyMnKS5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgIGxldCB0ZW1wID0geC5zcGxpdCgnOicpO1xuICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgc3BlY2lhbGl6YXRpb25zIDogbmV3IEFycmF5PHtuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXJ9PigpLFxuICAgICAgICAgIH07XG4gICAgICAgICAgZGF0YS5zcGVjaWFsaXphdGlvbnMucHVzaCh7bmFtZTogdGVtcFswXSwgdmFsdWU6IHBhcnNlSW50KHRlbXBbMV0pfSk7XG4gICAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgaW5wdXROb3RlKGU6IGFueSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBub3RlOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGlucHV0QWNjb3VudE5hbWUoZSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBhY2NvdW50TmFtZTogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuICBTaG93UGFzc3dvcmQoKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHNob3dQYXNzd29yZDogIXRoaXMuZGF0YS5zaG93UGFzc3dvcmRcbiAgICB9KVxuICB9LFxuICBpbnB1dFBhc3N3b3JkKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgYWNjb3VudFBhc3N3b3JkOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGlucHV0UGhvbmVOdW1iZXIoZSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBwaG9uZU51bWJlcjogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuICBjaGFuZ2VHdWFyZChlKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGhhc0d1YXJkOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIGdldEF2YWlsYWJsZUNvdXBvbigpIHtcbiAgICBhcHAucmVxdWVzdEZ1bmNQcm9taXNlKCcvb3JkZXIvYXZhaWxhYmxlQ291cG9uJywge3VzZXJJZDogdGhpcy5kYXRhLnVzZXJJZH0sICdHRVQnKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmKHJlcy5kYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgY291cG9uczogbmV3IEFycmF5PHtpZDogc3RyaW5nLCBzdGF0dXM6IG51bWJlciwgbmFtZTogc3RyaW5nLCBkaXNjb3VudDogbnVtYmVyLCBleHBpcmVUaW1lOiBEYXRlfT4oKVxuICAgICAgICB9O1xuICAgICAgICBkYXRhLmNvdXBvbnMucHVzaCh7aWQ6ICdudWxsJywgc3RhdHVzOiAxLCBuYW1lOiAn5LiN5L2/55So5LyY5oOg5Yi4JywgZGlzY291bnQ6IDAsIGV4cGlyZVRpbWU6IG5ldyBEYXRlKCl9KVxuICAgICAgICByZXMuZGF0YS5jb3Vwb25MaXN0LmZvckVhY2goeCA9PiB7XG4gICAgICAgICAgaWYoeC5zdGF0dXMgPT0gMSkge1xuICAgICAgICAgICAgZGF0YS5jb3Vwb25zLnB1c2goe2lkOiB4LmNvdXBvbklkLCBzdGF0dXM6IHguY291cG9uU3RhdHVzLCBuYW1lOiB4LmNvdXBvbk5hbWUsIGRpc2NvdW50OiB4LmNvdXBvbkRpc2NvdW50LCBleHBpcmVUaW1lOiB4LmV4cGlyZVRpbWV9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcbiAgICAgICAgdGhpcy5jYWxjTW9uZXkoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgY291cG9uQ2hhbmdlKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgY291cG9uSW5kZXg6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgICB0aGlzLmNhbGNNb25leSgpO1xuICB9LFxuICBjYWxjTW9uZXkoKSB7XG4gICAgaWYodGhpcy5kYXRhLmNvdXBvbnNbdGhpcy5kYXRhLmNvdXBvbkluZGV4XS5pZCAhPSAnbnVsbCcpIHtcbiAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICBtb25leTogdGhpcy5kYXRhLm1vbmV5LFxuICAgICAgICBvcmlnaW5Nb25leTogdGhpcy5kYXRhLm1vbmV5XG4gICAgICB9XG4gICAgICBkYXRhLm1vbmV5ID0gdGhpcy5kYXRhLm1vbmV5ICogdGhpcy5kYXRhLmNvdXBvbnNbdGhpcy5kYXRhLmNvdXBvbkluZGV4XS5kaXNjb3VudFxuICAgICAgdGhpcy5zZXREYXRhKGRhdGEpXG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICBtb25leTogdGhpcy5kYXRhLm9yaWdpbk1vbmV5LFxuICAgICAgICBvcmlnaW5Nb25leTogdGhpcy5kYXRhLm9yaWdpbk1vbmV5XG4gICAgICB9XG4gICAgICB0aGlzLnNldERhdGEoZGF0YSk7XG4gICAgfVxuICB9LFxuXG4gIGZvcm1TdWJtaXQoZSkge1xuICAgIGNvbnN0IF90aGlzID0gdGhpcztcbiAgICBsZXQgc3BlY1N0cmluZyA9ICcnO1xuICAgIGxldCBjaGVja1ZhbGlkID0gdHJ1ZTtcbiAgICB0aGlzLmRhdGEuc3BlY2lhbGl6YXRpb25zLmV2ZXJ5KHggPT4ge1xuICAgICAgaWYgKCghaXNOYU4oeC52YWx1ZSkgJiYgeC52YWx1ZSA+IDApKSB7XG4gICAgICAgIHNwZWNTdHJpbmcgKz0geC5uYW1lICsgJzonICsgeC52YWx1ZS50b1N0cmluZygpICsgJyMnXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFpc05hTih4LnZhbHVlKSAmJiB4LnZhbHVlIDw9IDApIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfkuJPnsr7nrYnnuqflv4XpobvlpKfkuo4wJyxcbiAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2hlY2tWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfor7fovpPlhaXkuJPnsr7nrYnnuqcnLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjaGVja1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZighY2hlY2tWYWxpZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzcGVjU3RyaW5nID0gc3BlY1N0cmluZy5zdWJzdHJpbmcoMCwgc3BlY1N0cmluZy5sZW5ndGggLSAxKTtcblxuICAgIGxldCBkZXRhaWxEYXRhID0ge1xuICAgICAgb3JkZXJJZDogdGhpcy5kYXRhLm9yZGVySWQgIT0gJycgPyB0aGlzLmRhdGEub3JkZXJJZDogJycsXG4gICAgICB1c2VySWQ6IHRoaXMuZGF0YS51c2VySWQsXG4gICAgICBvcmRlclR5cGU6IDEsXG4gICAgICBvcmRlclNlcnZlcjogdGhpcy5kYXRhLlJlYWxtVHlwZSxcbiAgICAgIG9yZGVyQ2F0YWxvZzogdGhpcy5kYXRhLm9yZGVyQ2F0YWxvZyxcbiAgICAgIG9yZGVyQ2F0YWxvZzE6IHRoaXMuZGF0YS5vcmRlckNhdGFsb2cxLFxuICAgICAgb3JkZXJDYXRhbG9nMjogdGhpcy5kYXRhLm9yZGVyQ2F0YWxvZzIsXG4gICAgICBvcmRlckNhdGFsb2czOiB0aGlzLmRhdGEub3JkZXJDYXRhbG9nMyxcbiAgICAgIG9yZGVyTW9uZXk6IHRoaXMuZGF0YS5tb25leSxcbiAgICAgIGNoYXJhY3RlcklkOiB0aGlzLmRhdGEuY2hhcmFjdGVySWQsXG4gICAgICBjaGFyYWN0ZXJJbmZvOiB0aGlzLmRhdGEuY2hhcmFjdGVyTmFtZSxcbiAgICAgIGNoYXJhY3RlclJlYWxtOiB0aGlzLmRhdGEuc2VydmVyTmFtZSxcbiAgICAgIGNoYXJhY3RlclNwZWM6IHNwZWNTdHJpbmcsXG4gICAgICBhY2NvdW50SWQ6IGUuZGV0YWlsLnZhbHVlLmFjY291bnROYW1lLFxuICAgICAgYWNjb3VudFBhc3N3b3JkOiBlLmRldGFpbC52YWx1ZS5hY2NvdW50UGFzc3dvcmQsXG4gICAgICBzYXZlZ3VhcmQ6IHRoaXMuZGF0YS5oYXNHdWFyZCxcbiAgICAgIHBob25lOiBlLmRldGFpbC52YWx1ZS5waG9uZU51bWJlcixcbiAgICAgIG5vdGU6IGUuZGV0YWlsLnZhbHVlLm5vdGUsXG4gICAgICByZW1vdGVBZGRyOiAnJyxcbiAgICAgIGNvdXBvbklkOiAnJ1xuICAgIH1cbiAgICBcbiAgICBcbiAgICBpZiAodGhpcy5kYXRhLm9yZGVyU3RhdHVzID09IDkpIHtcbiAgICAgIGRldGFpbERhdGEuY291cG9uSWQgPSB0aGlzLmRhdGEuY291cG9uc1t0aGlzLmRhdGEuY291cG9uSW5kZXhdLmlkICE9ICdudWxsJyA/IHRoaXMuZGF0YS5jb3Vwb25zW3RoaXMuZGF0YS5jb3Vwb25JbmRleF0uaWQgOiAnJ1xuICAgIH1cbiAgICBpZiAoZGV0YWlsRGF0YS5hY2NvdW50SWQgPT0gXCJcIikge1xuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6ICfor7fovpPlhaXotKblj7cnLFxuICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgIG1hc2s6IHRydWUsXG4gICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGRldGFpbERhdGEuYWNjb3VudFBhc3N3b3JkID09IFwiXCIpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+36L6T5YWl5a+G56CBJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBtYXNrOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChkZXRhaWxEYXRhLnBob25lID09IFwiXCIpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+36L6T5YWl5omL5py65Y+356CBJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBtYXNrOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgd3gucmVxdWVzdCh7XG4gICAgICB1cmw6ICdodHRwczovL3B2LnNvaHUuY29tL2NpdHlqc29uP2llPXV0Zi04JyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUuZGF0YSk7XG4gICAgICAgIGNvbnN0IGlwQWRkcmVzcyA9IGUuZGF0YS5zcGxpdCgnICcpWzRdLnJlcGxhY2UoJ1wiJywnJykucmVwbGFjZSgnXCInLCAnJykucmVwbGFjZSgnLCcsICcnKVxuICAgICAgICBkZXRhaWxEYXRhLnJlbW90ZUFkZHIgPSBpcEFkZHJlc3NcblxuICAgICAgICBhcHAucmVxdWVzdEZ1bmMoJy9vcmRlci9zYXZlT3JkZXInLCBkZXRhaWxEYXRhLCAnUE9TVCcsIHJlcyA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgICAgIGlmIChyZXMuZGF0YS5zdWNjZXNzID09IHRydWUpIHtcbiAgICAgICAgICAgIGlmKHJlcy5kYXRhLnBheUluZm8pIHtcbiAgICAgICAgICAgICAgd3gucmVxdWVzdFBheW1lbnQoe1xuICAgICAgICAgICAgICAgICd0aW1lU3RhbXAnOiByZXMuZGF0YS5wYXlJbmZvLnRpbWVTdGFtcC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICdub25jZVN0cic6IHJlcy5kYXRhLnBheUluZm8ubm9uY2VTdHIsXG4gICAgICAgICAgICAgICAgJ3BhY2thZ2UnOiByZXMuZGF0YS5wYXlJbmZvLnBhY2thZ2UsXG4gICAgICAgICAgICAgICAgJ3NpZ25UeXBlJzogcmVzLmRhdGEucGF5SW5mby5zaWduVHlwZSxcbiAgICAgICAgICAgICAgICAncGF5U2lnbic6IHJlcy5kYXRhLnBheUluZm8uc2lnbixcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jmiJDlip8nLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAwXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5pSv5LuY5aSx6LSlJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwMFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBfdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ0RldGFpbCdcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICBfdGhpcy5vblNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogcmVzLmRhdGEubXNnLFxuICAgICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICB0aXRsZTogcmVzLmRhdGEubXNnLFxuICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIGNhbmNlbE9yZGVyKCkge1xuICAgIGNvbnN0IF90aGlzID0gdGhpcztcbiAgICBsZXQgZGV0YWlsRGF0YSA9IHtcbiAgICAgIG9yZGVySWQ6IHRoaXMuZGF0YS5vcmRlcklkLFxuICAgICAgdXNlcklkOiB0aGlzLmRhdGEudXNlcklkXG4gICAgfVxuICAgIGFwcC5yZXF1ZXN0RnVuYygnL29yZGVyL2NhbmNlbE9yZGVyJywgZGV0YWlsRGF0YSwgJ1BPU1QnLCByZXMgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgaWYgKHJlcy5kYXRhLnN1Y2Nlc3MgPT0gdHJ1ZSkge1xuICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOiAn5Y+W5raI6K6i5Y2V5oiQ5YqfJyxcbiAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgfSk7XG4gICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgZGVsdGE6IDFcbiAgICAgICAgfSlcbiAgICAgICAgX3RoaXMub25TaG93KCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxufSlcbiJdfQ==